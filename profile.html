<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æœƒå“¡ä¸­å¿ƒ</title>
<link rel="stylesheet" href="./assets/style.css">
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
<div class="container" id="profile">
  <div class="loading">
    <div class="spinner"></div>
    <p style="margin-top: 15px; color: #666;">è¼‰å…¥æœƒå“¡è³‡æ–™ä¸­...</p>
  </div>
</div>

<script>
let currentUserId = '';
let currentPoints = 0;
let autoRefreshInterval = null;

async function initLiff() {
  try {
    // è¨˜éŒ„é–‹å§‹æ™‚é–“
    const startTime = Date.now();
    
    await liff.init({ liffId: "2008231108-2PDbO5qk" });
    
    if (!liff.isLoggedIn()) {
      // ğŸ”§ å„ªåŒ–ï¼šä½¿ç”¨ redirectUri ä¿ç•™ç•¶å‰é é¢
      liff.login({ redirectUri: window.location.href });
      return;
    }
    
    const profile = await liff.getProfile();
    const lineUserId = profile.userId;
    const displayName = profile.displayName;
    const pictureUrl = profile.pictureUrl;
    
    // ä¿å­˜ç•¶å‰ç”¨æˆ¶ ID
    currentUserId = lineUserId;
    
    // æª¢æŸ¥æœ¬åœ°å¿«å–
    const cacheKey = `profile_${lineUserId}`;
    const cached = getCache(cacheKey);
    
    // å¦‚æœæœ‰å¿«å–ï¼Œå…ˆé¡¯ç¤ºå¿«å–è³‡æ–™
    if (cached) {
      console.log('ä½¿ç”¨å¿«å–è³‡æ–™');
      currentPoints = cached.points || 0;
      renderProfile(cached, pictureUrl, displayName);
    }
    
    // åŒæ™‚ç™¼é€ API è«‹æ±‚æ›´æ–°æœ€æ–°è³‡æ–™
    const res = await fetch("https://script.google.com/macros/s/AKfycbyCMi57kJcJdatuDm7JXJXAf5e3xq1KRu3mN9XbXewVcESh5pFgAWsJ86nNiYZvY9XJ/exec?action=profile&lineUserId=" + lineUserId);
    const data = await res.json();
    
    // è¨˜éŒ„è¼‰å…¥æ™‚é–“
    const loadTime = Date.now() - startTime;
    console.log(`è¼‰å…¥æ™‚é–“: ${loadTime}ms`);
    
    // ä¿å­˜ç•¶å‰é»æ•¸
    currentPoints = data.points || 0;
    
    // æ›´æ–°å¿«å–ï¼ˆ5 åˆ†é˜æœ‰æ•ˆï¼‰
    setCache(cacheKey, data, 5 * 60 * 1000);
    
    // æ¸²æŸ“æœ€æ–°è³‡æ–™
    renderProfile(data, pictureUrl, displayName);
    
    // ğŸ”§ å•Ÿå‹•è‡ªå‹•åˆ·æ–°ï¼ˆæ¯ 10 ç§’æª¢æŸ¥ä¸€æ¬¡ï¼‰
    startAutoRefresh(lineUserId, pictureUrl, displayName);
    
  } catch (error) {
    console.error('LIFF åˆå§‹åŒ–éŒ¯èª¤:', error);
    document.getElementById("profile").innerHTML = `
      <div class="error-card">
        <div class="error-icon">âŒ</div>
        <h3>è¼‰å…¥å¤±æ•—</h3>
        <p>è«‹ç¨å¾Œå†è©¦æˆ–è¯ç¹«å®¢æœ</p>
        <button class="btn btn-primary" onclick="initLiff()">é‡æ–°è¼‰å…¥</button>
      </div>
    `;
  }
}

// ğŸ”§ è‡ªå‹•åˆ·æ–°åŠŸèƒ½
function startAutoRefresh(lineUserId, pictureUrl, displayName) {
  // æ¸…é™¤èˆŠçš„å®šæ™‚å™¨
  if (autoRefreshInterval) {
    clearInterval(autoRefreshInterval);
  }
  
  console.log('ğŸ”„ å•Ÿå‹•è‡ªå‹•åˆ·æ–°ï¼ˆæ¯ 5 ç§’æª¢æŸ¥ä¸€æ¬¡ï¼‰');
  
  // æ¯ 5 ç§’æª¢æŸ¥ä¸€æ¬¡
  autoRefreshInterval = setInterval(async () => {
    try {
      console.log('ğŸ” æª¢æŸ¥é»æ•¸æ›´æ–°ä¸­...', new Date().toLocaleTimeString());
      
      const res = await fetch("https://script.google.com/macros/s/AKfycbyCMi57kJcJdatuDm7JXJXAf5e3xq1KRu3mN9XbXewVcESh5pFgAWsJ86nNiYZvY9XJ/exec?action=profile&lineUserId=" + lineUserId);
      const data = await res.json();
      
      const newPoints = data.points || 0;
      
      console.log(`ç•¶å‰é»æ•¸: ${currentPoints} â†’ æœ€æ–°é»æ•¸: ${newPoints}`);
      
      // å¦‚æœé»æ•¸æœ‰è®ŠåŒ–
      if (newPoints !== currentPoints) {
        const pointsDiff = newPoints - currentPoints;
        
        console.log(`ğŸ‰ é»æ•¸è®Šå‹•: ${pointsDiff > 0 ? '+' : ''}${pointsDiff}`);
        
        // å¦‚æœæ˜¯å¢åŠ ï¼ˆæ”¶åˆ°é»æ•¸ï¼‰
        if (pointsDiff > 0) {
          // ğŸ”§ ç²å–æœ€æ–°äº¤æ˜“è¨˜éŒ„ï¼ŒæŸ¥çœ‹æ˜¯èª°è½‰çš„
          await showReceivedPointsNotification(lineUserId, pointsDiff);
        }
        
        // æ›´æ–°ç•¶å‰é»æ•¸
        currentPoints = newPoints;
        
        // é‡æ–°æ¸²æŸ“
        renderProfile(data, pictureUrl, displayName);
        
        console.log('âœ… é é¢å·²æ›´æ–°');
      } else {
        console.log('â¸ï¸ é»æ•¸ç„¡è®ŠåŒ–');
      }
    } catch (error) {
      console.error('âŒ è‡ªå‹•åˆ·æ–°å¤±æ•—:', error);
    }
  }, 5000); // 5 ç§’
  
  console.log('âœ… è‡ªå‹•åˆ·æ–°å·²å•Ÿå‹•ï¼ˆæ¯ 5 ç§’æª¢æŸ¥ä¸€æ¬¡ï¼‰');
}

// ğŸ”§ é é¢å¯è¦‹æ€§æª¢æ¸¬ï¼šç•¶ç”¨æˆ¶åˆ‡å›é é¢æ™‚ç«‹å³æª¢æŸ¥
document.addEventListener('visibilitychange', async () => {
  if (!document.hidden && currentUserId) {
    console.log('ğŸ‘ï¸ é é¢é‡æ–°å¯è¦‹ï¼Œç«‹å³æª¢æŸ¥é»æ•¸');
    try {
      const profile = await liff.getProfile();
      const res = await fetch("https://script.google.com/macros/s/AKfycbyCMi57kJcJdatuDm7JXJXAf5e3xq1KRu3mN9XbXewVcESh5pFgAWsJ86nNiYZvY9XJ/exec?action=profile&lineUserId=" + currentUserId);
      const data = await res.json();
      
      const newPoints = data.points || 0;
      if (newPoints !== currentPoints) {
        const pointsDiff = newPoints - currentPoints;
        if (pointsDiff > 0) {
          await showReceivedPointsNotification(currentUserId, pointsDiff);
        }
        currentPoints = newPoints;
        renderProfile(data, profile.pictureUrl, profile.displayName);
        console.log('âœ… é é¢å·²æ›´æ–°');
      }
    } catch (error) {
      console.error('âŒ ç«‹å³æª¢æŸ¥å¤±æ•—:', error);
    }
  }
});

// ğŸ”§ é¡¯ç¤ºæ”¶åˆ°é»æ•¸çš„é€šçŸ¥
async function showReceivedPointsNotification(lineUserId, pointsDiff) {
  try {
    // ç²å–æœ€æ–°çš„äº¤æ˜“è¨˜éŒ„
    const res = await fetch(`https://script.google.com/macros/s/AKfycbyCMi57kJcJdatuDm7JXJXAf5e3xq1KRu3mN9XbXewVcESh5pFgAWsJ86nNiYZvY9XJ/exec?action=transactions&lineUserId=${lineUserId}&limit=5`);
    const data = await res.json();
    
    if (data.success && data.transactions && data.transactions.length > 0) {
      // æ‰¾å‡ºæœ€æ–°çš„è½‰å…¥è¨˜éŒ„
      const latestTransfer = data.transactions.find(t => t.type === 'transfer_in');
      
      let senderName = 'æŸä½å¥½å‹';
      if (latestTransfer && latestTransfer.senderName) {
        senderName = latestTransfer.senderName;
      }
      
      // é¡¯ç¤ºé€šçŸ¥
      showPointsNotification(senderName, pointsDiff);
    } else {
      // æ²’æœ‰äº¤æ˜“è¨˜éŒ„ï¼Œé¡¯ç¤ºä¸€èˆ¬é€šçŸ¥
      showPointsNotification('ç³»çµ±', pointsDiff);
    }
  } catch (error) {
    console.error('ç²å–äº¤æ˜“è¨˜éŒ„å¤±æ•—:', error);
    showPointsNotification('æŸä½å¥½å‹', pointsDiff);
  }
}

// ğŸ”§ é¡¯ç¤ºé»æ•¸é€šçŸ¥å½ˆçª—
function showPointsNotification(senderName, points) {
  // å‰µå»ºé€šçŸ¥å…ƒç´ 
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(135deg, #FFF3CD, #FFE69C);
    border: 3px solid #FFB800;
    border-radius: 20px;
    padding: 32px;
    box-shadow: 0 12px 48px rgba(255, 184, 0, 0.4);
    z-index: 10000;
    text-align: center;
    min-width: 280px;
    animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  `;
  
  notification.innerHTML = `
    <div style="font-size: 64px; margin-bottom: 16px; animation: pulse 1s ease infinite;">â¤ï¸</div>
    <h3 style="margin: 0 0 12px 0; color: #FFB800; font-size: 22px; font-weight: bold;">æ”¶åˆ°å…¬ç›Šé»æ•¸ï¼</h3>
    <p style="margin: 0 0 8px 0; font-size: 18px; color: #333;">
      ä¾†è‡ª <strong style="color: #FFB800;">${senderName}</strong>
    </p>
    <p style="margin: 0; font-size: 32px; font-weight: 800; color: #FFB800;">
      +${points} <span style="font-size: 18px;">é»</span>
    </p>
  `;
  
  // æ·»åŠ å‹•ç•«æ¨£å¼
  const style = document.createElement('style');
  style.textContent = `
    @keyframes bounceIn {
      0% { opacity: 0; transform: translate(-50%, -50%) scale(0.3); }
      50% { opacity: 1; transform: translate(-50%, -50%) scale(1.05); }
      70% { transform: translate(-50%, -50%) scale(0.9); }
      100% { transform: translate(-50%, -50%) scale(1); }
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
  `;
  document.head.appendChild(style);
  
  // æ·»åŠ åˆ°é é¢
  document.body.appendChild(notification);
  
  // 3 ç§’å¾Œè‡ªå‹•ç§»é™¤
  setTimeout(() => {
    notification.style.animation = 'fadeOut 0.3s ease';
    setTimeout(() => {
      document.body.removeChild(notification);
    }, 300);
  }, 3000);
  
  // æ’­æ”¾æç¤ºéŸ³ï¼ˆå¯é¸ï¼‰
  try {
    const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIGGa57OmfTgwNUKXh8bllHQU2jdXxx3ElBSh+zPDckD8KFmC28OqnVRIKRp/g8r5sIQYrf88=' );
    audio.volume = 0.3;
    audio.play().catch(() => {});
  } catch (e) {}
}

// æ¸²æŸ“æœƒå“¡è³‡æ–™
function renderProfile(data, pictureUrl, displayName) {
  document.getElementById("profile").innerHTML = `
    <div class="profile-card">
      <div class="profile-header">
        <img src="${pictureUrl}" alt="é ­åƒ" class="profile-avatar">
        <div class="profile-header-center">
          <h2 style="text-align:left;margin:0;">${data.name || displayName || 'æœƒå“¡'}</h2>
        </div>
        <div class="points-card">
          <div class="points-icon">â¤ï¸</div>
          <div class="points-info">
            <p class="points-label" style="color: #856404; font-weight: 600;">å…¬ç›Šé»æ•¸</p>
            <p class="points-value" style="color: #FFB800;">${data.points || 0} <span style="color: #856404;">é»</span></p>
          </div>
        </div>
      </div>
      
      <div class="profile-info">
        <div class="info-item">
          <span class="info-label">ğŸ“± é›»è©±</span>
          <span class="info-value">${data.phone || 'æœªç™»éŒ„'}</span>
        </div>
        <div class="info-item">
          <span class="info-label">ğŸ“§ Email</span>
          <span class="info-value">${data.email || 'æœªç™»éŒ„'}</span>
        </div>
      </div>
      
      <!-- â¤ï¸ å…¬ç›Šæ¨è–¦å€å¡Š -->
      <div class="referral-section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 20px; margin: 20px 0; color: white; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
          <span style="font-size: 28px;">â¤ï¸</span>
          <div>
            <h3 style="margin: 0; font-size: 18px; font-weight: bold; color: #fff;">é‚€è«‹å¥½å‹ä¸€èµ·åšå…¬ç›Š</h3>
            <p style="margin: 5px 0 0 0; font-size: 14px; color: rgba(255,255,255,0.95); font-weight: 500;">å‚³éæ„›å¿ƒï¼Œè®“å–„æ„å»¶çºŒ</p>
          </div>
        </div>
        
        <div style="background: rgba(255,255,255,0.2); border-radius: 8px; padding: 14px; margin-bottom: 12px; border: 1px solid rgba(255,255,255,0.3);">
          <p style="margin: 0 0 10px 0; font-size: 14px; color: #fff; font-weight: 600;">æ‚¨çš„å°ˆå±¬æ¨è–¦ç¢¼</p>
          <div style="display: flex; align-items: center; gap: 10px;">
            <input type="text" id="referralCodeDisplay" value="${data.referralCode || 'è¼‰å…¥ä¸­...'}" readonly 
                   style="flex: 1; background: rgba(255,255,255,0.95); border: none; border-radius: 6px; padding: 12px 14px; font-size: 20px; font-weight: 800; letter-spacing: 3px; text-align: center; color: #764ba2;">
            <button onclick="copyReferralCode('${data.referralCode}')" 
                    style="background: rgba(255,255,255,0.3); border: 2px solid rgba(255,255,255,0.6); border-radius: 6px; padding: 12px 18px; color: #fff; font-weight: bold; cursor: pointer; transition: all 0.3s; font-size: 14px;">
              ğŸ“‹ è¤‡è£½
            </button>
          </div>
        </div>
        
        <div style="display: flex; gap: 8px;">
          <button onclick="shareReferralLink('${data.referralCode}')" class="btn" 
                  style="flex: 1; background: rgba(255,255,255,0.3); border: 2px solid rgba(255,255,255,0.6); color: #fff; font-weight: bold; padding: 12px; font-size: 14px;">
            <span style="font-size: 18px;">ğŸ“¤</span> åˆ†äº«æ¨è–¦
          </button>
          <button onclick="viewReferralStats()" class="btn" 
                  style="flex: 1; background: rgba(255,255,255,0.3); border: 2px solid rgba(255,255,255,0.6); color: #fff; font-weight: bold; padding: 12px; font-size: 14px;">
            <span style="font-size: 18px;">ğŸ“Š</span> æ¨è–¦è¨˜éŒ„
          </button>
        </div>
        
        <p style="margin: 12px 0 0 0; font-size: 13px; text-align: center; color: #fff; font-weight: 500;">
          æ‚¨å·²æ¨è–¦ <strong style="font-size: 18px; color: #FFD700; font-weight: 800;">${data.referralCount || 0}</strong> ä½å¥½å‹åŠ å…¥å…¬ç›Šè¡Œåˆ— â¤ï¸
        </p>
      </div>
      
      <div class="action-buttons">
        <button class="btn btn-primary" onclick="goPurchase()" style="background: linear-gradient(135deg, #FFB800, #E69500); border-color: #FFB800;">
          <span class="btn-icon">ğŸ’°</span>
          è³¼è²·å…¬ç›Šé»æ•¸
        </button>
        <button class="btn btn-primary" onclick="goWithdraw()" style="background: linear-gradient(135deg, #FF6B00, #E65100); border-color: #FF6B00;">
          <span class="btn-icon">ğŸ’µ</span>
          æé ˜å…Œç¾
        </button>
        <button class="btn btn-secondary" onclick="goWithdrawalHistory()" style="background: linear-gradient(135deg, #9C27B0, #7B1FA2); border-color: #9C27B0; color: white;">
          <span class="btn-icon">ğŸ“‹</span>
          æé ˜è¨˜éŒ„
        </button>
        <button class="btn btn-primary" onclick="goTransfer()">
          <span class="btn-icon">â¤ï¸</span>
          åˆ†äº«å…¬ç›Šé»æ•¸
        </button>
        <button class="btn btn-secondary" onclick="goHistory()">
          <span class="btn-icon">ğŸ“Š</span>
          é»æ•¸è¨˜éŒ„
        </button>
        <button class="btn btn-outline" onclick="editProfile()">
          <span class="btn-icon">âœï¸</span>
          ç·¨è¼¯è³‡æ–™
        </button>
      </div>
    </div>
  `;
}

// ç°¡å–®çš„æœ¬åœ°å¿«å–
function setCache(key, data, ttl = 5 * 60 * 1000) {
  const item = {
    data: data,
    expiry: Date.now() + ttl
  };
  try {
    localStorage.setItem(key, JSON.stringify(item));
  } catch (e) {
    console.warn('å¿«å–å„²å­˜å¤±æ•—:', e);
  }
}

function getCache(key) {
  try {
    const item = localStorage.getItem(key);
    if (!item) return null;
    
    const parsed = JSON.parse(item);
    if (Date.now() > parsed.expiry) {
      localStorage.removeItem(key);
      return null;
    }
    
    return parsed.data;
  } catch (e) {
    return null;
  }
}

function goPurchase() {
  window.location.href = "purchase.html";
}

function goWithdraw() {
  window.location.href = "withdraw.html";
}

function goWithdrawalHistory() {
  window.location.href = "withdrawal-history.html";
}

function goTransfer() {
  window.location.href = "transfer.html";
}

function goHistory() {
  window.location.href = "history.html";
}

function editProfile() {
  window.location.href = "edit.html";
}

// ğŸ è¤‡è£½æ¨è–¦ç¢¼
function copyReferralCode(code) {
  if (!code || code === 'è¼‰å…¥ä¸­...') {
    alert('æ¨è–¦ç¢¼å°šæœªè¼‰å…¥ï¼Œè«‹ç¨å¾Œå†è©¦');
    return;
  }
  
  // è¤‡è£½åˆ°å‰ªè²¼ç°¿
  if (navigator.clipboard) {
    navigator.clipboard.writeText(code).then(() => {
      alert('âœ… æ¨è–¦ç¢¼å·²è¤‡è£½ï¼\n\n' + code);
    }).catch(() => {
      // é™ç´šæ–¹æ¡ˆ
      fallbackCopyTextToClipboard(code);
    });
  } else {
    fallbackCopyTextToClipboard(code);
  }
}

// é™ç´šè¤‡è£½æ–¹æ¡ˆ
function fallbackCopyTextToClipboard(text) {
  const textArea = document.createElement("textarea");
  textArea.value = text;
  textArea.style.position = "fixed";
  textArea.style.top = "-999999px";
  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();
  
  try {
    document.execCommand('copy');
    alert('âœ… æ¨è–¦ç¢¼å·²è¤‡è£½ï¼\n\n' + text);
  } catch (err) {
    alert('âŒ è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ï¼š\n\n' + text);
  }
  
  document.body.removeChild(textArea);
}

// ğŸ“¤ åˆ†äº«æ¨è–¦é€£çµ
function shareReferralLink(code) {
  if (!code || code === 'è¼‰å…¥ä¸­...') {
    alert('æ¨è–¦ç¢¼å°šæœªè¼‰å…¥ï¼Œè«‹ç¨å¾Œå†è©¦');
    return;
  }
  
  // ğŸ”— ç”Ÿæˆæ¨è–¦é€£çµï¼ˆè«‹æ›¿æ›ç‚ºä½ çš„å¯¦éš›ç¶²å€ï¼‰
  const baseUrl = window.location.origin + window.location.pathname.replace('profile.html', '');
  const referralLink = `${baseUrl}register.html?ref=${code}`;
  
  // åˆ†äº«è¨Šæ¯ï¼ˆå…¬ç›Šæ…ˆå–„ç‰ˆï¼‰
  const shareMessage = `â¤ï¸ é‚€è«‹ä½ ä¸€èµ·åšå…¬ç›Šï¼\n\n` +
                      `åŠ å…¥å…¬ç›Šæ…ˆå–„æœƒå“¡ï¼Œå‚³éæ„›å¿ƒã€å¹«åŠ©éœ€è¦çš„äººã€‚\n` +
                      `è¨»å†Šå³è´ˆé€ 100 å…¬ç›Šé»æ•¸ï¼Œè®“æ‚¨ç«‹å³é–‹å§‹è¡Œå–„ï¼\n\n` +
                      `ğŸ‘‰ ç«‹å³åŠ å…¥ï¼š${referralLink}\n\n` +
                      `æ¨è–¦ç¢¼ï¼š${code}\n` +
                      `è®“æˆ‘å€‘ä¸€èµ·è®“ä¸–ç•Œæ›´ç¾å¥½ ğŸŒŸ`;
  
  // å¦‚æœåœ¨ LINE LIFF ç’°å¢ƒä¸­ï¼Œä½¿ç”¨ LINE åˆ†äº«
  if (typeof liff !== 'undefined' && liff.isInClient()) {
    liff.shareTargetPicker([
      {
        type: 'text',
        text: shareMessage
      }
    ]).then(() => {
      console.log('åˆ†äº«æˆåŠŸ');
    }).catch((err) => {
      console.error('åˆ†äº«å¤±æ•—', err);
      // é™ç´šä½¿ç”¨è¤‡è£½é€£çµ
      fallbackShare(referralLink, shareMessage);
    });
  } else {
    // ä½¿ç”¨ Web Share API æˆ–é™ç´šæ–¹æ¡ˆ
    if (navigator.share) {
      navigator.share({
        title: 'é‚€è«‹å¥½å‹åŠ å…¥æœƒå“¡',
        text: shareMessage
      }).catch(() => {
        fallbackShare(referralLink, shareMessage);
      });
    } else {
      fallbackShare(referralLink, shareMessage);
    }
  }
}

// é™ç´šåˆ†äº«æ–¹æ¡ˆ
function fallbackShare(link, message) {
  if (confirm('ğŸ“‹ æ˜¯å¦è¤‡è£½æ¨è–¦é€£çµåˆ°å‰ªè²¼ç°¿ï¼Ÿ\n\nä½ å¯ä»¥è²¼åˆ°ä»»ä½•åœ°æ–¹åˆ†äº«çµ¦å¥½å‹ï¼')) {
    if (navigator.clipboard) {
      navigator.clipboard.writeText(link).then(() => {
        alert('âœ… æ¨è–¦é€£çµå·²è¤‡è£½ï¼\n\n' + link + '\n\nå¿«å»åˆ†äº«çµ¦å¥½å‹å§ï¼');
      });
    } else {
      fallbackCopyTextToClipboard(link);
    }
  }
}

// ğŸ“Š æŸ¥çœ‹æ¨è–¦çµ±è¨ˆ
function viewReferralStats() {
  window.location.href = 'referral-stats.html';
}

// èˆŠçš„æç¤ºåŠŸèƒ½ï¼ˆå·²æ£„ç”¨ï¼‰
function viewReferralStatsOld() {
  alert('ğŸ“Š æ¨è–¦çµ±è¨ˆåŠŸèƒ½é–‹ç™¼ä¸­...\n\n' +
        'å³å°‡é¡¯ç¤ºï¼š\n' +
        'â€¢ æ¨è–¦äººæ•¸\n' +
        'â€¢ ç²å¾—çå‹µ\n' +
        'â€¢ æ¨è–¦æ˜ç´°');
}

initLiff();
</script>
</body>
</html>

