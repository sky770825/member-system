<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ¸¬è©¦å•†åŸ API</title>
<style>
body {
  font-family: 'Microsoft JhengHei', sans-serif;
  max-width: 800px;
  margin: 40px auto;
  padding: 20px;
  background: #f5f5f5;
}

.card {
  background: white;
  border-radius: 12px;
  padding: 24px;
  margin-bottom: 20px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

h1 {
  color: #667eea;
  margin: 0 0 20px 0;
}

.btn {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  margin-right: 10px;
  margin-bottom: 10px;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.result {
  background: #f8f9fa;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  padding: 16px;
  margin-top: 16px;
  font-family: 'Consolas', monospace;
  font-size: 13px;
  white-space: pre-wrap;
  word-wrap: break-word;
  max-height: 400px;
  overflow-y: auto;
}

.success {
  border-color: #4CAF50;
  background: #E8F5E9;
}

.error {
  border-color: #f44336;
  background: #FFEBEE;
}

.info {
  background: #E3F2FD;
  border: 2px solid #2196F3;
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 20px;
}

textarea {
  width: 100%;
  min-height: 100px;
  padding: 12px;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  font-family: 'Consolas', monospace;
  font-size: 13px;
  margin-bottom: 10px;
}

input {
  width: 100%;
  padding: 10px;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  margin-bottom: 10px;
  font-size: 14px;
}

label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: #333;
}
</style>
</head>
<body>

<div class="card">
  <h1>ğŸ§ª æ¸¬è©¦å•†åŸ API</h1>
  
  <div class="info">
    <strong>ğŸ“ ä½¿ç”¨èªªæ˜ï¼š</strong><br>
    1. è¼¸å…¥æ‚¨çš„ Apps Script URL<br>
    2. é»æ“Šã€Œæ¸¬è©¦è¼‰å…¥å•†å“ã€<br>
    3. æŸ¥çœ‹æ˜¯å¦æœ‰å•†å“è³‡æ–™<br>
    4. å¦‚æœæ²’æœ‰ï¼Œä½¿ç”¨ä¸‹æ–¹å·¥å…·æ–°å¢æ¸¬è©¦å•†å“
  </div>
  
  <label>æ‚¨çš„ Apps Script URLï¼š</label>
  <input type="text" id="apiUrl" 
         placeholder="https://script.google.com/macros/s/AKfycbz.../exec"
         value="https://script.google.com/macros/s/AKfycbzMUwqroi_W_5m7rcjVs-U-o6tEo9W0327BeMmU38Rxinmycd5d1HyyF3BnugGvNF6r/exec">
  
  <button class="btn" onclick="testMallProducts()">ğŸ§ª æ¸¬è©¦è¼‰å…¥å•†å“</button>
  <button class="btn" onclick="testAddProduct()">â• æ–°å¢æ‹æ–°èå•†å“</button>
  <button class="btn" onclick="clearCache()">ğŸ—‘ï¸ æ¸…é™¤å¿«å–</button>
  
  <div id="result"></div>
</div>

<div class="card">
  <h2>ğŸ“¦ æ–°å¢æ¸¬è©¦å•†å“</h2>
  
  <label>å•†å“è³‡æ–™ï¼ˆJSON æ ¼å¼ï¼‰ï¼š</label>
  <textarea id="productData">{
  "productId": "X7Z5P3",
  "productName": "æ‹æ–°è",
  "description": "ç²å¾—æ‹æ–°èè™›æ“¬å•†å“åºè™Ÿ",
  "imageUrl": "https://i.postimg.cc/3R5j7t6k/Pi-News-GIF2.gif",
  "points": 3600,
  "originalPrice": 3600,
  "stock": -1,
  "category": "virtual",
  "isActive": true,
  "soldCount": 0,
  "tags": "è™›æ“¬å•†å“,åºè™Ÿ"
}</textarea>
  
  <button class="btn" onclick="addProduct()">â• æ–°å¢é€™å€‹å•†å“åˆ° Sheets</button>
  
  <div id="addResult"></div>
</div>

<div class="card">
  <h2>ğŸ“‹ æ‰‹å‹•è¤‡è£½åˆ° Google Sheets</h2>
  
  <p><strong>å¦‚æœ API æ–¹å¼ç„¡æ³•ä½¿ç”¨ï¼Œè«‹æ‰‹å‹•è¤‡è£½ï¼š</strong></p>
  
  <label>æ¬„ä½æ¨™é¡Œï¼ˆç¬¬ä¸€è¡Œï¼‰ï¼š</label>
  <textarea readonly onclick="this.select()">productId	productName	description	imageUrl	points	originalPrice	stock	category	sellerId	sellerName	sellerPhone	sellerReferralCode	isActive	soldCount	tags	createdAt	updatedAt</textarea>
  
  <label>å•†å“è³‡æ–™ï¼ˆç¬¬äºŒè¡Œï¼‰ï¼š</label>
  <textarea readonly onclick="this.select()">X7Z5P3	æ‹æ–°è	ç²å¾—æ‹æ–°èè™›æ“¬å•†å“åºè™Ÿ	https://i.postimg.cc/3R5j7t6k/Pi-News-GIF2.gif	3600	3600	-1	virtual			USER001	TRUE	0	è™›æ“¬å•†å“,åºè™Ÿ	2025-10-18	2025-10-18</textarea>
  
  <div style="background: #FFF3E0; padding: 12px; border-radius: 8px; margin-top: 12px;">
    <strong>ğŸ’¡ æç¤ºï¼š</strong><br>
    é»æ“Šä¸Šæ–¹æ–‡å­—æ¡†æœƒè‡ªå‹•å…¨é¸ï¼Œç„¶å¾ŒæŒ‰ Ctrl+C è¤‡è£½ï¼Œåˆ° Google Sheets æŒ‰ Ctrl+V è²¼ä¸Šå³å¯ï¼
  </div>
</div>

<script>
const DEFAULT_API = 'https://script.google.com/macros/s/AKfycbzMUwqroi_W_5m7rcjVs-U-o6tEo9W0327BeMmU38Rxinmycd5d1HyyF3BnugGvNF6r/exec';

async function testMallProducts() {
  const apiUrl = document.getElementById('apiUrl').value || DEFAULT_API;
  const resultDiv = document.getElementById('result');
  
  resultDiv.innerHTML = 'ğŸ” æ¸¬è©¦ä¸­...';
  resultDiv.className = 'result';
  
  try {
    const url = `${apiUrl}?action=mall-products`;
    console.log('æ¸¬è©¦ URL:', url);
    
    const res = await fetch(url);
    const data = await res.json();
    
    console.log('å›æ‡‰è³‡æ–™:', data);
    
    if (data.success) {
      const products = data.products || [];
      resultDiv.className = 'result success';
      resultDiv.innerHTML = `
âœ… API æ¸¬è©¦æˆåŠŸï¼

æ‰¾åˆ° ${products.length} å€‹å•†å“

${products.length > 0 ? 'å•†å“åˆ—è¡¨ï¼š\n' + JSON.stringify(products, null, 2) : 'âš ï¸ å•†å“åˆ—è¡¨æ˜¯ç©ºçš„ï¼\n\nè«‹åœ¨ Google Sheets çš„ MallProducts å·¥ä½œè¡¨æ–°å¢å•†å“è³‡æ–™'}
      `;
    } else {
      resultDiv.className = 'result error';
      resultDiv.innerHTML = `
âŒ API å›æ‡‰å¤±æ•—

éŒ¯èª¤è¨Šæ¯ï¼š${data.message || 'æœªçŸ¥éŒ¯èª¤'}

å¯èƒ½åŸå› ï¼š
1. MallProducts å·¥ä½œè¡¨ä¸å­˜åœ¨
2. å·¥ä½œè¡¨åç¨±æ‹¼å¯«éŒ¯èª¤
3. Apps Script æ²’æœ‰è™•ç† mall-products action

å®Œæ•´å›æ‡‰ï¼š
${JSON.stringify(data, null, 2)}
      `;
    }
  } catch (error) {
    resultDiv.className = 'result error';
    resultDiv.innerHTML = `
âŒ æ¸¬è©¦å¤±æ•—

éŒ¯èª¤ï¼š${error.message}

å¯èƒ½åŸå› ï¼š
1. Apps Script URL ä¸æ­£ç¢º
2. CORS å•é¡Œ
3. Apps Script æœªæ­£ç¢ºéƒ¨ç½²

è«‹æª¢æŸ¥ï¼š
â€¢ Apps Script æ˜¯å¦å·²éƒ¨ç½²
â€¢ éƒ¨ç½²è¨­å®šã€Œå…·æœ‰æ‡‰ç”¨ç¨‹å¼å­˜å–æ¬Šçš„ä½¿ç”¨è€…ã€= æ‰€æœ‰äºº
    `;
  }
}

async function testAddProduct() {
  alert('âš ï¸ æ­¤åŠŸèƒ½éœ€è¦ Apps Script æ”¯æ´ add-product action\n\nå»ºè­°ä½¿ç”¨æ‰‹å‹•è¤‡è£½è²¼ä¸Šçš„æ–¹å¼ï¼\n\nè«‹çœ‹ä¸‹æ–¹ã€Œæ‰‹å‹•è¤‡è£½åˆ° Google Sheetsã€å€å¡Š');
}

async function addProduct() {
  const apiUrl = document.getElementById('apiUrl').value || DEFAULT_API;
  const productDataText = document.getElementById('productData').value;
  const resultDiv = document.getElementById('addResult');
  
  try {
    const product = JSON.parse(productDataText);
    
    resultDiv.innerHTML = 'ğŸ“¤ æ–°å¢ä¸­...';
    resultDiv.className = 'result';
    
    // å»ºæ§‹URLåƒæ•¸
    const params = new URLSearchParams({
      action: 'add-mall-product',
      productId: product.productId,
      productName: product.productName,
      description: product.description,
      imageUrl: product.imageUrl,
      points: product.points,
      originalPrice: product.originalPrice,
      stock: product.stock,
      category: product.category,
      isActive: product.isActive,
      tags: product.tags
    });
    
    const res = await fetch(`${apiUrl}?${params.toString()}`);
    const data = await res.json();
    
    if (data.success) {
      resultDiv.className = 'result success';
      resultDiv.innerHTML = `
âœ… å•†å“æ–°å¢æˆåŠŸï¼

å•†å“IDï¼š${product.productId}
å•†å“åç¨±ï¼š${product.productName}

ç¾åœ¨å¯ä»¥åœ¨å•†åŸçœ‹åˆ°é€™å€‹å•†å“äº†ï¼
      `;
      
      // æ¸…é™¤å¿«å–
      localStorage.removeItem('mall_products');
    } else {
      resultDiv.className = 'result error';
      resultDiv.innerHTML = `
âŒ æ–°å¢å¤±æ•—

éŒ¯èª¤ï¼š${data.message || 'æœªçŸ¥éŒ¯èª¤'}

å»ºè­°ï¼šè«‹ä½¿ç”¨æ‰‹å‹•è¤‡è£½è²¼ä¸Šçš„æ–¹å¼ï¼ˆè¦‹ä¸‹æ–¹ï¼‰
      `;
    }
  } catch (error) {
    resultDiv.className = 'result error';
    resultDiv.innerHTML = `
âŒ æ–°å¢å¤±æ•—

éŒ¯èª¤ï¼š${error.message}

å»ºè­°ï¼š
1. æª¢æŸ¥ JSON æ ¼å¼æ˜¯å¦æ­£ç¢º
2. æˆ–ä½¿ç”¨æ‰‹å‹•è¤‡è£½è²¼ä¸Šçš„æ–¹å¼ï¼ˆè¦‹ä¸‹æ–¹ï¼‰
    `;
  }
}

function clearCache() {
  localStorage.clear();
  alert('âœ… å¿«å–å·²æ¸…é™¤ï¼');
  location.reload();
}
</script>

</body>
</html>

