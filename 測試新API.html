<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ¸¬è©¦æ–° API</title>
<style>
body {
  font-family: Arial, sans-serif;
  max-width: 900px;
  margin: 20px auto;
  padding: 20px;
  background: #f5f5f5;
}
.api-card {
  background: white;
  padding: 20px;
  border-radius: 8px;
  margin-bottom: 20px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.api-url {
  background: #2d2d2d;
  color: #f8f8f2;
  padding: 15px;
  border-radius: 6px;
  font-family: 'Courier New', monospace;
  font-size: 13px;
  word-break: break-all;
  margin: 10px 0;
}
.result {
  padding: 15px;
  border-radius: 6px;
  margin-top: 10px;
  font-family: 'Courier New', monospace;
  white-space: pre-wrap;
  word-break: break-all;
  font-size: 13px;
}
.success { background: #d4edda; color: #155724; border: 2px solid #28a745; }
.error { background: #f8d7da; color: #721c24; border: 2px solid #dc3545; }
.warning { background: #fff3cd; color: #856404; border: 2px solid #ffc107; }
button {
  background: #667eea;
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  margin: 5px;
}
button:hover { background: #5568d3; }
h2 { color: #333; border-bottom: 3px solid #667eea; padding-bottom: 10px; }
</style>
</head>
<body>

<h1>ğŸ§ª API æ¸¬è©¦å·¥å…·</h1>

<div class="api-card">
  <h2>ğŸ“¡ æ–°ç™¼ç¾çš„ API</h2>
  <div class="api-url">
    https://script.google.com/macros/s/AKfycbygQ_CNmM8K-a-m5RvdAOoRwuIj3BEY0snUyROgCSFyDfo2VpsTKSXmhh4tYfxv5Q7O/exec
  </div>
  <button onclick="testNewAPI()">æ¸¬è©¦ç‰ˆæœ¬</button>
  <button onclick="testNewAPIProducts()">æ¸¬è©¦å•†å“åˆ—è¡¨</button>
  <div id="newResult"></div>
</div>

<div class="api-card">
  <h2>ğŸ“¡ ç›®å‰ä½¿ç”¨çš„ API</h2>
  <div class="api-url">
    https://script.google.com/macros/s/AKfycbzjGZOfhfd792G7hv-6wbyClTxcvD1n5zsxRQC6yfJatjKG5fTayhyz3EdhUNDDNQ96/exec
  </div>
  <button onclick="testCurrentAPI()">æ¸¬è©¦ç‰ˆæœ¬</button>
  <button onclick="testCurrentAPIProducts()">æ¸¬è©¦å•†å“åˆ—è¡¨</button>
  <div id="currentResult"></div>
</div>

<div class="api-card">
  <h2>ğŸ“Š å°æ¯”çµæœ</h2>
  <div id="comparison" class="result warning" style="display:none;">
    ç­‰å¾…æ¸¬è©¦çµæœ...
  </div>
</div>

<script>
const NEW_API = 'https://script.google.com/macros/s/AKfycbygQ_CNmM8K-a-m5RvdAOoRwuIj3BEY0snUyROgCSFyDfo2VpsTKSXmhh4tYfxv5Q7O/exec';
const CURRENT_API = 'https://script.google.com/macros/s/AKfycbzjGZOfhfd792G7hv-6wbyClTxcvD1n5zsxRQC6yfJatjKG5fTayhyz3EdhUNDDNQ96/exec';

async function testNewAPI() {
  const resultDiv = document.getElementById('newResult');
  resultDiv.style.display = 'block';
  resultDiv.className = 'result warning';
  resultDiv.textContent = 'æ¸¬è©¦ä¸­...';
  
  try {
    const res = await fetch(`${NEW_API}?action=version`);
    const data = await res.json();
    
    resultDiv.textContent = JSON.stringify(data, null, 2);
    resultDiv.className = data.success ? 'result success' : 'result error';
  } catch (error) {
    resultDiv.textContent = `éŒ¯èª¤: ${error.message}`;
    resultDiv.className = 'result error';
  }
  
  updateComparison();
}

async function testNewAPIProducts() {
  const resultDiv = document.getElementById('newResult');
  resultDiv.style.display = 'block';
  resultDiv.className = 'result warning';
  resultDiv.textContent = 'æ¸¬è©¦å•†å“åˆ—è¡¨...';
  
  try {
    const res = await fetch(`${NEW_API}?action=mall-products`);
    const data = await res.json();
    
    resultDiv.textContent = JSON.stringify(data, null, 2);
    resultDiv.className = data.success ? 'result success' : 'result error';
    
    if (data.success && data.products) {
      resultDiv.textContent = `âœ… æˆåŠŸï¼æ‰¾åˆ° ${data.products.length} å€‹å•†å“\n\n` + JSON.stringify(data, null, 2);
    }
  } catch (error) {
    resultDiv.textContent = `éŒ¯èª¤: ${error.message}`;
    resultDiv.className = 'result error';
  }
  
  updateComparison();
}

async function testCurrentAPI() {
  const resultDiv = document.getElementById('currentResult');
  resultDiv.style.display = 'block';
  resultDiv.className = 'result warning';
  resultDiv.textContent = 'æ¸¬è©¦ä¸­...';
  
  try {
    const res = await fetch(`${CURRENT_API}?action=version`);
    const data = await res.json();
    
    resultDiv.textContent = JSON.stringify(data, null, 2);
    resultDiv.className = data.success ? 'result success' : 'result error';
  } catch (error) {
    resultDiv.textContent = `éŒ¯èª¤: ${error.message}`;
    resultDiv.className = 'result error';
  }
  
  updateComparison();
}

async function testCurrentAPIProducts() {
  const resultDiv = document.getElementById('currentResult');
  resultDiv.style.display = 'block';
  resultDiv.className = 'result warning';
  resultDiv.textContent = 'æ¸¬è©¦å•†å“åˆ—è¡¨...';
  
  try {
    const res = await fetch(`${CURRENT_API}?action=mall-products`);
    const data = await res.json();
    
    resultDiv.textContent = JSON.stringify(data, null, 2);
    resultDiv.className = data.success ? 'result success' : 'result error';
    
    if (data.success && data.products) {
      resultDiv.textContent = `âœ… æˆåŠŸï¼æ‰¾åˆ° ${data.products.length} å€‹å•†å“\n\n` + JSON.stringify(data, null, 2);
    }
  } catch (error) {
    resultDiv.textContent = `éŒ¯èª¤: ${error.message}`;
    resultDiv.className = 'result error';
  }
  
  updateComparison();
}

function updateComparison() {
  const compDiv = document.getElementById('comparison');
  const newResult = document.getElementById('newResult').textContent;
  const currentResult = document.getElementById('currentResult').textContent;
  
  if (newResult && currentResult && newResult !== 'ç­‰å¾…æ¸¬è©¦...' && currentResult !== 'ç­‰å¾…æ¸¬è©¦...') {
    compDiv.style.display = 'block';
    
    let comparison = 'ğŸ“Š å°æ¯”åˆ†æ\n\n';
    
    // æª¢æŸ¥ç‰ˆæœ¬
    if (newResult.includes('"version"')) {
      const newVersion = newResult.match(/"version":\s*"([^"]+)"/)?.[1] || 'æœªçŸ¥';
      const currentVersion = currentResult.match(/"version":\s*"([^"]+)"/)?.[1] || 'æœªçŸ¥';
      
      comparison += `æ–° API ç‰ˆæœ¬: ${newVersion}\n`;
      comparison += `ç›®å‰ API ç‰ˆæœ¬: ${currentVersion}\n\n`;
      
      if (newVersion === currentVersion) {
        comparison += 'âœ… ç‰ˆæœ¬ç›¸åŒ\n';
      } else {
        comparison += 'âš ï¸ ç‰ˆæœ¬ä¸åŒï¼å»ºè­°ä½¿ç”¨è¼ƒæ–°çš„ç‰ˆæœ¬\n';
      }
    }
    
    // æª¢æŸ¥å•†å“æ•¸é‡
    if (newResult.includes('"products"')) {
      const newCount = (newResult.match(/"total":\s*(\d+)/)?.[1] || '0');
      const currentCount = (currentResult.match(/"total":\s*(\d+)/)?.[1] || '0');
      
      comparison += `\nğŸ“¦ å•†å“æ•¸é‡ï¼š\n`;
      comparison += `æ–° API: ${newCount} å€‹å•†å“\n`;
      comparison += `ç›®å‰ API: ${currentCount} å€‹å•†å“\n\n`;
      
      if (newCount === currentCount) {
        comparison += 'âœ… å•†å“æ•¸é‡ç›¸åŒ\n';
      } else {
        comparison += 'âš ï¸ å•†å“æ•¸é‡ä¸åŒï¼\n';
      }
    }
    
    comparison += '\nğŸ’¡ å»ºè­°ï¼š\n';
    comparison += '- å¦‚æœå…©å€‹ API åŠŸèƒ½ç›¸åŒï¼Œçµ±ä¸€ä½¿ç”¨ä¸€å€‹å³å¯\n';
    comparison += '- å»ºè­°ä½¿ç”¨ç‰ˆæœ¬è¼ƒæ–°ã€å•†å“è¼ƒå¤šçš„ API\n';
    comparison += '- æ›´æ–°æ‰€æœ‰å‰ç«¯é é¢æŒ‡å‘åŒä¸€å€‹ API\n';
    
    compDiv.textContent = comparison;
    compDiv.className = 'result warning';
  }
}

// è‡ªå‹•æ¸¬è©¦
window.onload = () => {
  setTimeout(() => {
    testNewAPI();
    testCurrentAPI();
  }, 500);
};
</script>

</body>
</html>

