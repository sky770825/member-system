<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>測試新 API</title>
<style>
body {
  font-family: Arial, sans-serif;
  max-width: 900px;
  margin: 20px auto;
  padding: 20px;
  background: #f5f5f5;
}
.api-card {
  background: white;
  padding: 20px;
  border-radius: 8px;
  margin-bottom: 20px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.api-url {
  background: #2d2d2d;
  color: #f8f8f2;
  padding: 15px;
  border-radius: 6px;
  font-family: 'Courier New', monospace;
  font-size: 13px;
  word-break: break-all;
  margin: 10px 0;
}
.result {
  padding: 15px;
  border-radius: 6px;
  margin-top: 10px;
  font-family: 'Courier New', monospace;
  white-space: pre-wrap;
  word-break: break-all;
  font-size: 13px;
}
.success { background: #d4edda; color: #155724; border: 2px solid #28a745; }
.error { background: #f8d7da; color: #721c24; border: 2px solid #dc3545; }
.warning { background: #fff3cd; color: #856404; border: 2px solid #ffc107; }
button {
  background: #667eea;
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  margin: 5px;
}
button:hover { background: #5568d3; }
h2 { color: #333; border-bottom: 3px solid #667eea; padding-bottom: 10px; }
</style>
</head>
<body>

<h1>🧪 API 測試工具</h1>

<div class="api-card">
  <h2>📡 新發現的 API</h2>
  <div class="api-url">
    https://script.google.com/macros/s/AKfycbygQ_CNmM8K-a-m5RvdAOoRwuIj3BEY0snUyROgCSFyDfo2VpsTKSXmhh4tYfxv5Q7O/exec
  </div>
  <button onclick="testNewAPI()">測試版本</button>
  <button onclick="testNewAPIProducts()">測試商品列表</button>
  <div id="newResult"></div>
</div>

<div class="api-card">
  <h2>📡 目前使用的 API</h2>
  <div class="api-url">
    https://script.google.com/macros/s/AKfycbzjGZOfhfd792G7hv-6wbyClTxcvD1n5zsxRQC6yfJatjKG5fTayhyz3EdhUNDDNQ96/exec
  </div>
  <button onclick="testCurrentAPI()">測試版本</button>
  <button onclick="testCurrentAPIProducts()">測試商品列表</button>
  <div id="currentResult"></div>
</div>

<div class="api-card">
  <h2>📊 對比結果</h2>
  <div id="comparison" class="result warning" style="display:none;">
    等待測試結果...
  </div>
</div>

<script>
const NEW_API = 'https://script.google.com/macros/s/AKfycbygQ_CNmM8K-a-m5RvdAOoRwuIj3BEY0snUyROgCSFyDfo2VpsTKSXmhh4tYfxv5Q7O/exec';
const CURRENT_API = 'https://script.google.com/macros/s/AKfycbzjGZOfhfd792G7hv-6wbyClTxcvD1n5zsxRQC6yfJatjKG5fTayhyz3EdhUNDDNQ96/exec';

async function testNewAPI() {
  const resultDiv = document.getElementById('newResult');
  resultDiv.style.display = 'block';
  resultDiv.className = 'result warning';
  resultDiv.textContent = '測試中...';
  
  try {
    const res = await fetch(`${NEW_API}?action=version`);
    const data = await res.json();
    
    resultDiv.textContent = JSON.stringify(data, null, 2);
    resultDiv.className = data.success ? 'result success' : 'result error';
  } catch (error) {
    resultDiv.textContent = `錯誤: ${error.message}`;
    resultDiv.className = 'result error';
  }
  
  updateComparison();
}

async function testNewAPIProducts() {
  const resultDiv = document.getElementById('newResult');
  resultDiv.style.display = 'block';
  resultDiv.className = 'result warning';
  resultDiv.textContent = '測試商品列表...';
  
  try {
    const res = await fetch(`${NEW_API}?action=mall-products`);
    const data = await res.json();
    
    resultDiv.textContent = JSON.stringify(data, null, 2);
    resultDiv.className = data.success ? 'result success' : 'result error';
    
    if (data.success && data.products) {
      resultDiv.textContent = `✅ 成功！找到 ${data.products.length} 個商品\n\n` + JSON.stringify(data, null, 2);
    }
  } catch (error) {
    resultDiv.textContent = `錯誤: ${error.message}`;
    resultDiv.className = 'result error';
  }
  
  updateComparison();
}

async function testCurrentAPI() {
  const resultDiv = document.getElementById('currentResult');
  resultDiv.style.display = 'block';
  resultDiv.className = 'result warning';
  resultDiv.textContent = '測試中...';
  
  try {
    const res = await fetch(`${CURRENT_API}?action=version`);
    const data = await res.json();
    
    resultDiv.textContent = JSON.stringify(data, null, 2);
    resultDiv.className = data.success ? 'result success' : 'result error';
  } catch (error) {
    resultDiv.textContent = `錯誤: ${error.message}`;
    resultDiv.className = 'result error';
  }
  
  updateComparison();
}

async function testCurrentAPIProducts() {
  const resultDiv = document.getElementById('currentResult');
  resultDiv.style.display = 'block';
  resultDiv.className = 'result warning';
  resultDiv.textContent = '測試商品列表...';
  
  try {
    const res = await fetch(`${CURRENT_API}?action=mall-products`);
    const data = await res.json();
    
    resultDiv.textContent = JSON.stringify(data, null, 2);
    resultDiv.className = data.success ? 'result success' : 'result error';
    
    if (data.success && data.products) {
      resultDiv.textContent = `✅ 成功！找到 ${data.products.length} 個商品\n\n` + JSON.stringify(data, null, 2);
    }
  } catch (error) {
    resultDiv.textContent = `錯誤: ${error.message}`;
    resultDiv.className = 'result error';
  }
  
  updateComparison();
}

function updateComparison() {
  const compDiv = document.getElementById('comparison');
  const newResult = document.getElementById('newResult').textContent;
  const currentResult = document.getElementById('currentResult').textContent;
  
  if (newResult && currentResult && newResult !== '等待測試...' && currentResult !== '等待測試...') {
    compDiv.style.display = 'block';
    
    let comparison = '📊 對比分析\n\n';
    
    // 檢查版本
    if (newResult.includes('"version"')) {
      const newVersion = newResult.match(/"version":\s*"([^"]+)"/)?.[1] || '未知';
      const currentVersion = currentResult.match(/"version":\s*"([^"]+)"/)?.[1] || '未知';
      
      comparison += `新 API 版本: ${newVersion}\n`;
      comparison += `目前 API 版本: ${currentVersion}\n\n`;
      
      if (newVersion === currentVersion) {
        comparison += '✅ 版本相同\n';
      } else {
        comparison += '⚠️ 版本不同！建議使用較新的版本\n';
      }
    }
    
    // 檢查商品數量
    if (newResult.includes('"products"')) {
      const newCount = (newResult.match(/"total":\s*(\d+)/)?.[1] || '0');
      const currentCount = (currentResult.match(/"total":\s*(\d+)/)?.[1] || '0');
      
      comparison += `\n📦 商品數量：\n`;
      comparison += `新 API: ${newCount} 個商品\n`;
      comparison += `目前 API: ${currentCount} 個商品\n\n`;
      
      if (newCount === currentCount) {
        comparison += '✅ 商品數量相同\n';
      } else {
        comparison += '⚠️ 商品數量不同！\n';
      }
    }
    
    comparison += '\n💡 建議：\n';
    comparison += '- 如果兩個 API 功能相同，統一使用一個即可\n';
    comparison += '- 建議使用版本較新、商品較多的 API\n';
    comparison += '- 更新所有前端頁面指向同一個 API\n';
    
    compDiv.textContent = comparison;
    compDiv.className = 'result warning';
  }
}

// 自動測試
window.onload = () => {
  setTimeout(() => {
    testNewAPI();
    testCurrentAPI();
  }, 500);
};
</script>

</body>
</html>

