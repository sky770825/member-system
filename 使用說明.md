# 會員註冊系統 - 使用說明

## 📚 目錄

1. [快速開始](#快速開始)
2. [功能說明](#功能說明)
3. [API 文件](#api-文件)
4. [設定檔說明](#設定檔說明)
5. [擴充功能](#擴充功能)

---

## 🚀 快速開始

### 最快 5 分鐘部署方案

1. **建立 Google Sheets**
   - 開啟 [Google Sheets](https://sheets.google.com/)
   - 建立新試算表
   - 複製 Sheet ID

2. **部署 Apps Script**
   - 開啟 **擴充功能 → Apps Script**
   - 貼上 `google-apps-script.js` 內容
   - 修改 `SHEET_ID`
   - 部署為 Web App
   - 複製部署 URL

3. **設定 LINE LIFF**
   - 前往 [LINE Developers](https://developers.line.biz/)
   - 建立 3 個 LIFF 應用
   - 記下 LIFF ID

4. **部署前端**
   - 上傳到 GitHub
   - 啟用 GitHub Pages
   - 更新 HTML 中的設定

5. **測試**
   - 在 LINE 中開啟 LIFF URL
   - 完成註冊測試

---

## 💡 功能說明

### 1. 會員註冊 (register.html)

#### 功能特色
- ✅ LINE LIFF 自動登入
- ✅ 自動取得 LINE 使用者資料
- ✅ 手機號碼格式驗證（自動格式化）
- ✅ Email 格式驗證
- ✅ 重複註冊檢查
- ✅ 註冊成功贈送 100 點

#### 使用流程
1. 使用者從 LINE 開啟註冊頁面
2. 系統自動取得 LINE User ID 和顯示名稱
3. 使用者填寫必要資料（姓名、手機）
4. 系統檢查是否已註冊或手機號碼重複
5. 註冊成功後自動跳轉到會員中心

#### 表單欄位
| 欄位 | 必填 | 說明 |
|------|------|------|
| 姓名 | ✅ | 真實姓名 |
| 手機號碼 | ✅ | 格式：0912-345-678 |
| Email | ❌ | 選填 |
| 生日 | ❌ | 選填，可用於生日優惠 |

### 2. 會員中心 (profile.html)

#### 功能特色
- 👤 顯示會員資料和 LINE 頭像
- 💰 即時顯示點數餘額
- 📊 快速操作按鈕
- 🎨 美觀的 UI 設計

#### 顯示資訊
- LINE 頭像
- 會員姓名
- 手機號碼
- Email
- 當前點數

#### 操作按鈕
- **轉點給好友** - 跳轉到轉點頁面
- **點數記錄** - 查看交易歷史（需自行實作）
- **編輯資料** - 修改會員資料（需自行實作）

### 3. 點數轉移 (transfer.html)

#### 功能特色
- 💸 即時轉點功能
- ✅ 自動驗證收款人
- 🎯 快速選擇金額
- 📝 轉點留言
- ✔️ 轉點確認視窗

#### 使用流程
1. 輸入收款人手機號碼
2. 系統自動驗證並顯示收款人姓名
3. 輸入轉點數量（或使用快速選擇）
4. 選填留言
5. 確認轉點資訊
6. 完成轉點

#### 驗證規則
- ❌ 不能轉點給自己
- ❌ 點數不足
- ❌ 收款人不存在
- ❌ 轉點數量小於 1

---

## 📡 API 文件

### 基礎資訊

**Base URL:**
```
https://script.google.com/macros/s/[YOUR_DEPLOYMENT_ID]/exec
```

**認證方式:** 無需認證（公開 API）

**回應格式:** JSON

---

### 1. 檢查會員是否存在

**端點:** `GET /exec?action=check`

**參數:**
| 參數 | 類型 | 必填 | 說明 |
|------|------|------|------|
| lineUserId | string | ✅ | LINE User ID |

**請求範例:**
```bash
GET /exec?action=check&lineUserId=U1234567890
```

**成功回應:**
```json
{
  "registered": true,
  "member": {
    "name": "王小明",
    "phone": "0912-345-678",
    "points": 150
  }
}
```

**未註冊回應:**
```json
{
  "registered": false
}
```

---

### 2. 取得會員資料

**端點:** `GET /exec?action=profile`

**參數:**
| 參數 | 類型 | 必填 | 說明 |
|------|------|------|------|
| lineUserId | string | ✅ | LINE User ID |

**請求範例:**
```bash
GET /exec?action=profile&lineUserId=U1234567890
```

**成功回應:**
```json
{
  "success": true,
  "lineUserId": "U1234567890",
  "name": "王小明",
  "phone": "0912-345-678",
  "email": "wang@example.com",
  "birthday": "1990-01-01",
  "lineName": "Wang Ming",
  "linePicture": "https://...",
  "points": 150,
  "createdAt": "2025-10-11T10:00:00.000Z",
  "updatedAt": "2025-10-11T10:30:00.000Z"
}
```

---

### 3. 透過手機號碼檢查會員

**端點:** `GET /exec?action=check-user`

**參數:**
| 參數 | 類型 | 必填 | 說明 |
|------|------|------|------|
| phone | string | ✅ | 手機號碼 |

**請求範例:**
```bash
GET /exec?action=check-user&phone=0912-345-678
```

**找到會員:**
```json
{
  "exists": true,
  "name": "王小明",
  "lineUserId": "U1234567890",
  "phone": "0912-345-678"
}
```

**找不到會員:**
```json
{
  "exists": false
}
```

---

### 4. 註冊新會員

**端點:** `POST /exec?action=register`

**請求 Body:**
```json
{
  "lineUserId": "U1234567890",
  "name": "王小明",
  "phone": "0912-345-678",
  "email": "wang@example.com",
  "birthday": "1990-01-01",
  "lineName": "Wang Ming",
  "linePicture": "https://..."
}
```

**成功回應:**
```json
{
  "success": true,
  "message": "註冊成功",
  "points": 100
}
```

**失敗回應:**
```json
{
  "success": false,
  "message": "此帳號已經註冊過了"
}
```

---

### 5. 點數轉移

**端點:** `POST /exec?action=transfer`

**請求 Body:**
```json
{
  "senderUserId": "U1234567890",
  "receiverPhone": "0923-456-789",
  "receiverUserId": "U0987654321",
  "points": 50,
  "message": "謝謝你！"
}
```

**成功回應:**
```json
{
  "success": true,
  "message": "轉點成功",
  "remainingPoints": 100,
  "receiverNewPoints": 150
}
```

**失敗回應:**
```json
{
  "success": false,
  "message": "點數不足"
}
```

---

### 6. 取得交易記錄

**端點:** `GET /exec?action=transactions`

**參數:**
| 參數 | 類型 | 必填 | 說明 |
|------|------|------|------|
| lineUserId | string | ✅ | LINE User ID |
| limit | number | ❌ | 限制筆數（預設 20） |

**請求範例:**
```bash
GET /exec?action=transactions&lineUserId=U1234567890&limit=10
```

**成功回應:**
```json
{
  "success": true,
  "transactions": [
    {
      "id": "uuid-1234",
      "type": "transfer_out",
      "senderUserId": "U1234567890",
      "receiverUserId": "U0987654321",
      "senderName": "王小明",
      "receiverName": "李小華",
      "points": -50,
      "message": "謝謝",
      "createdAt": "2025-10-11T10:30:00.000Z"
    }
  ],
  "total": 1
}
```

---

### 7. 更新會員資料

**端點:** `POST /exec?action=update-profile`

**請求 Body:**
```json
{
  "lineUserId": "U1234567890",
  "name": "王大明",
  "email": "new@example.com"
}
```

**成功回應:**
```json
{
  "success": true,
  "message": "更新成功"
}
```

---

### 8. 管理員調整點數

**端點:** `POST /exec?action=adjust-points`

**請求 Body:**
```json
{
  "lineUserId": "U1234567890",
  "points": 100,
  "reason": "補償"
}
```

**成功回應:**
```json
{
  "success": true,
  "message": "調整成功",
  "newPoints": 250
}
```

---

## ⚙️ 設定檔說明

使用 `config.template.js` 作為設定檔範本：

### 1. LIFF 設定

```javascript
LIFF: {
  REGISTER: '1234567890-AbCdEfGh',  // 註冊頁面 LIFF ID
  PROFILE: '1234567890-IjKlMnOp',   // 會員中心 LIFF ID
  TRANSFER: '1234567890-QrStUvWx',  // 轉點頁面 LIFF ID
}
```

### 2. API 端點設定

```javascript
API: {
  BASE_URL: 'https://script.google.com/macros/s/YOUR_ID/exec',
  ENDPOINTS: {
    CHECK: '?action=check',
    PROFILE: '?action=profile',
    // ...
  }
}
```

### 3. 前端網址設定

```javascript
FRONTEND: {
  DOMAIN: 'https://username.github.io/repo-name',
  PAGES: {
    INDEX: '/index.html',
    REGISTER: '/register.html',
    // ...
  }
}
```

### 4. 系統設定

```javascript
SYSTEM: {
  INITIAL_POINTS: 100,      // 註冊贈送點數
  MIN_TRANSFER_POINTS: 1,   // 最小轉點數量
  MAX_TRANSFER_POINTS: 0,   // 最大轉點數量（0=不限制）
  DEBUG_MODE: false,        // 除錯模式
}
```

---

## 🔧 擴充功能

### 1. 新增點數記錄頁面

建立 `history.html`：

```javascript
// 取得交易記錄
const res = await fetch(
  CONFIG.getApiUrl(CONFIG.API.ENDPOINTS.TRANSACTIONS, {
    lineUserId: lineUserId,
    limit: 50
  })
);
const data = await res.json();

// 顯示記錄
data.transactions.forEach(trans => {
  // 顯示交易項目
});
```

### 2. 新增編輯資料頁面

建立 `edit.html`：

```javascript
// 更新會員資料
const res = await fetch(
  CONFIG.API.BASE_URL + CONFIG.API.ENDPOINTS.UPDATE_PROFILE,
  {
    method: 'POST',
    body: JSON.stringify({
      lineUserId: lineUserId,
      name: newName,
      email: newEmail
    })
  }
);
```

### 3. 新增點數排行榜

在 Apps Script 中已包含 `getLeaderboard()` 函數：

```javascript
// 呼叫排行榜 API
const res = await fetch(
  CONFIG.getApiUrl('?action=leaderboard', { limit: 10 })
);
```

### 4. 新增統計報表

在 Apps Script 中已包含 `getStatistics()` 函數：

```javascript
// 取得統計資料
const res = await fetch(
  CONFIG.getApiUrl('?action=statistics')
);
```

### 5. LINE 推播通知

整合 LINE Messaging API：

```javascript
// 在 Apps Script 中新增
function sendLineNotify(userId, message) {
  const url = 'https://api.line.me/v2/bot/message/push';
  const payload = {
    to: userId,
    messages: [{
      type: 'text',
      text: message
    }]
  };
  
  UrlFetchApp.fetch(url, {
    method: 'post',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer YOUR_CHANNEL_ACCESS_TOKEN'
    },
    payload: JSON.stringify(payload)
  });
}
```

---

## 📊 資料結構

### Members 表

```
lineUserId    | name   | phone         | email              | birthday   | points | createdAt
------------- | ------ | ------------- | ------------------ | ---------- | ------ | ----------
U1234567890   | 王小明  | 0912-345-678  | wang@example.com   | 1990-01-01 | 150    | 2025-10-11
U0987654321   | 李小華  | 0923-456-789  | lee@example.com    | 1992-05-15 | 200    | 2025-10-11
```

### Transactions 表

```
id       | type          | senderUserId | receiverUserId | points | message | createdAt
-------- | ------------- | ------------ | -------------- | ------ | ------- | ----------
uuid-001 | register      |              | U1234567890    | 100    | 註冊贈送 | 2025-10-11
uuid-002 | transfer_out  | U1234567890  | U0987654321    | -50    | 謝謝    | 2025-10-11
uuid-003 | transfer_in   | U1234567890  | U0987654321    | 50     | 謝謝    | 2025-10-11
```

---

## 🎯 最佳實踐

### 1. 錯誤處理

```javascript
try {
  const res = await fetch(url);
  const data = await res.json();
  
  if (data.success) {
    // 處理成功
  } else {
    // 顯示錯誤訊息
    showMessage(data.message, 'error');
  }
} catch (error) {
  // 處理網路錯誤
  showMessage('系統錯誤，請稍後再試', 'error');
  CONFIG.error('API Error:', error);
}
```

### 2. 載入狀態

```javascript
// 顯示載入中
submitBtn.disabled = true;
submitBtn.innerHTML = '<span class="spinner-small"></span> 處理中...';

// 完成後恢復
submitBtn.disabled = false;
submitBtn.innerHTML = '送出';
```

### 3. 資料驗證

```javascript
// 前端驗證
if (!phone || phone.length < 12) {
  showMessage('請輸入正確的手機號碼', 'error');
  return;
}

// 後端也要驗證
```

---

**完整文件請參考 [部署指南.md](./部署指南.md)** 📖

