<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æª¢æŸ¥ Google Sheets å·¥ä½œè¡¨åç¨±</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 900px;
    margin: 20px auto;
    padding: 20px;
    background: #f5f5f5;
  }
  
  .card {
    background: white;
    border-radius: 10px;
    padding: 30px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    margin-bottom: 20px;
  }
  
  h1 {
    color: #667eea;
    margin-top: 0;
  }
  
  h2 {
    color: #764ba2;
    border-bottom: 2px solid #667eea;
    padding-bottom: 10px;
  }
  
  .result {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 5px;
    margin: 10px 0;
    font-family: monospace;
    white-space: pre-wrap;
  }
  
  .success {
    background: #d4edda;
    border-left: 4px solid #28a745;
  }
  
  .error {
    background: #f8d7da;
    border-left: 4px solid #dc3545;
  }
  
  .warning {
    background: #fff3cd;
    border-left: 4px solid #ffc107;
  }
  
  .info {
    background: #d1ecf1;
    border-left: 4px solid #0c5460;
  }
  
  table {
    width: 100%;
    border-collapse: collapse;
    margin: 15px 0;
  }
  
  th, td {
    border: 1px solid #ddd;
    padding: 12px;
    text-align: left;
  }
  
  th {
    background: #667eea;
    color: white;
    font-weight: bold;
  }
  
  tr:nth-child(even) {
    background: #f8f9fa;
  }
  
  button {
    background: #667eea;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    cursor: pointer;
    margin: 5px;
    font-size: 14px;
  }
  
  button:hover {
    background: #5568d3;
  }
  
  .code {
    background: #2d2d2d;
    color: #f8f8f2;
    padding: 15px;
    border-radius: 5px;
    overflow-x: auto;
    font-family: 'Courier New', monospace;
    margin: 10px 0;
  }
</style>
</head>
<body>

<div class="card">
  <h1>ğŸ” Google Sheets å·¥ä½œè¡¨åç¨±æª¢æŸ¥</h1>
  
  <div class="info">
    <strong>ğŸ“ é‡è¦èªªæ˜ï¼š</strong>é€™å€‹å·¥å…·æœƒæª¢æŸ¥æ‚¨çš„ Google Sheets å·¥ä½œè¡¨åç¨±æ˜¯å¦èˆ‡ Apps Script ä¸­çš„è¨­å®šä¸€è‡´ã€‚<br>
    <strong>âš ï¸ å¦‚æœåç¨±ä¸ä¸€è‡´ï¼Œæœƒå°è‡´ç„¡æ³•è¨»å†Šå’Œç™»å…¥ï¼</strong>
  </div>
</div>

<div class="card">
  <h2>ğŸ“‹ Apps Script ä¸­çš„è¨­å®šï¼ˆé æœŸçš„åç¨±ï¼‰</h2>
  
  <table>
    <tr>
      <th>å¸¸æ•¸åç¨±</th>
      <th>å·¥ä½œè¡¨åç¨±ï¼ˆä¸­æ–‡ï¼‰</th>
      <th>èªªæ˜</th>
    </tr>
    <tr>
      <td>MEMBERS_SHEET</td>
      <td><strong>æœƒå“¡è³‡æ–™</strong></td>
      <td>å­˜å„²æ‰€æœ‰æœƒå“¡è³‡è¨Š</td>
    </tr>
    <tr>
      <td>TRANSACTIONS_SHEET</td>
      <td><strong>äº¤æ˜“è¨˜éŒ„</strong></td>
      <td>é»æ•¸äº¤æ˜“æ­·å²</td>
    </tr>
    <tr>
      <td>REFERRALS_SHEET</td>
      <td><strong>æ¨è–¦é—œä¿‚</strong></td>
      <td>æœƒå“¡æ¨è–¦é—œä¿‚</td>
    </tr>
    <tr>
      <td>PURCHASES_SHEET</td>
      <td><strong>è³¼è²·è¨˜éŒ„</strong></td>
      <td>é»æ•¸è³¼è²·è¨˜éŒ„</td>
    </tr>
    <tr>
      <td>WITHDRAWALS_SHEET</td>
      <td><strong>æé ˜è¨˜éŒ„</strong></td>
      <td>é»æ•¸æé ˜è¨˜éŒ„</td>
    </tr>
    <tr>
      <td>PRODUCTS_SHEET</td>
      <td><strong>å•†åŸå•†å“</strong></td>
      <td>å•†å“è³‡è¨Š</td>
    </tr>
    <tr>
      <td>MALL_ORDERS_SHEET</td>
      <td><strong>å•†åŸè¨‚å–®</strong></td>
      <td>å•†åŸè¨‚å–®è¨˜éŒ„</td>
    </tr>
    <tr>
      <td>MEMBER_LEVELS_SHEET</td>
      <td><strong>æœƒå“¡ç­‰ç´š</strong></td>
      <td>æœƒå“¡ç­‰ç´šè¨­å®š</td>
    </tr>
    <tr>
      <td>ACTIVITIES_SHEET</td>
      <td><strong>æ´»å‹•è¨˜éŒ„</strong></td>
      <td>æœƒå“¡æ´»å‹•æ—¥èªŒ</td>
    </tr>
    <tr>
      <td>SETTINGS_SHEET</td>
      <td><strong>ç³»çµ±è¨­å®š</strong></td>
      <td>ç³»çµ±åƒæ•¸è¨­å®š</td>
    </tr>
    <tr>
      <td>DAILY_STATS_SHEET</td>
      <td><strong>æ¯æ—¥çµ±è¨ˆ</strong></td>
      <td>æ¯æ—¥æ•¸æ“šçµ±è¨ˆ</td>
    </tr>
  </table>
</div>

<div class="card">
  <h2>ğŸ” å¦‚ä½•æª¢æŸ¥æ‚¨çš„ Google Sheets</h2>
  
  <div class="warning">
    <strong>âš ï¸ è«‹ç«‹å³åŸ·è¡Œä»¥ä¸‹æ­¥é©Ÿï¼š</strong>
  </div>
  
  <ol style="line-height: 2;">
    <li>
      <strong>é–‹å•Ÿæ‚¨çš„ Google Sheetsï¼š</strong>
      <div class="code">
https://docs.google.com/spreadsheets/d/1EdLfJQzYroQ9WMqVEqcDuMpGwiTPj8gxLaMnGp3umDw/edit
      </div>
    </li>
    
    <li>
      <strong>æŸ¥çœ‹åº•éƒ¨çš„å·¥ä½œè¡¨æ¨™ç±¤åç¨±</strong>
      <br>æ‡‰è©²çœ‹åˆ°ï¼š<code>æœƒå“¡è³‡æ–™</code>, <code>äº¤æ˜“è¨˜éŒ„</code>, <code>æ¨è–¦é—œä¿‚</code> ç­‰
    </li>
    
    <li>
      <strong>å°ç…§ä¸Šé¢çš„è¡¨æ ¼</strong>
      <br>ç¢ºèªæ¯å€‹å·¥ä½œè¡¨åç¨±æ˜¯å¦å®Œå…¨ä¸€è‡´ï¼ˆåŒ…æ‹¬ç©ºæ ¼ï¼‰
    </li>
  </ol>
</div>

<div class="card">
  <h2>âŒ å¸¸è¦‹çš„åç¨±ä¸ä¸€è‡´å•é¡Œ</h2>
  
  <table>
    <tr>
      <th>Apps Script é æœŸ</th>
      <th>å¯èƒ½çš„éŒ¯èª¤åç¨±</th>
      <th>çµæœ</th>
    </tr>
    <tr>
      <td>æœƒå“¡è³‡æ–™</td>
      <td>Members / ä¼šå‘˜èµ„æ–™ / æœƒå“¡è³‡æ–™è¡¨</td>
      <td>âŒ æ‰¾ä¸åˆ°å·¥ä½œè¡¨</td>
    </tr>
    <tr>
      <td>äº¤æ˜“è¨˜éŒ„</td>
      <td>Transactions / äº¤æ˜“è®°å½• / äº¤æ˜“ç´€éŒ„</td>
      <td>âŒ æ‰¾ä¸åˆ°å·¥ä½œè¡¨</td>
    </tr>
    <tr>
      <td>æ¨è–¦é—œä¿‚</td>
      <td>Referrals / æ¨èå…³ç³» / æ¨è–¦å…³ç³»</td>
      <td>âŒ æ‰¾ä¸åˆ°å·¥ä½œè¡¨</td>
    </tr>
  </table>
  
  <div class="warning">
    <strong>âš ï¸ æ³¨æ„ï¼š</strong>
    <ul>
      <li>ç¹é«”ä¸­æ–‡å’Œç°¡é«”ä¸­æ–‡ä¸åŒ</li>
      <li>æœ‰ç„¡ç©ºæ ¼æœƒå½±éŸ¿</li>
      <li>ã€Œè¨˜éŒ„ã€å’Œã€Œç´€éŒ„ã€ä¸åŒ</li>
      <li>ã€Œé—œä¿‚ã€å’Œã€Œå…³ç³»ã€ä¸åŒ</li>
    </ul>
  </div>
</div>

<div class="card">
  <h2>âœ… è§£æ±ºæ–¹æ¡ˆ</h2>
  
  <h3>æ–¹æ¡ˆ Aï¼šä¿®æ”¹ Google Sheets å·¥ä½œè¡¨åç¨±ï¼ˆæ¨è–¦ï¼‰â­â­â­â­â­</h3>
  
  <p><strong>å¦‚æœæ‚¨çš„å·¥ä½œè¡¨æ˜¯è‹±æ–‡åç¨±æˆ–å…¶ä»–åç¨±ï¼š</strong></p>
  
  <ol style="line-height: 2;">
    <li>åœ¨ Google Sheets ä¸­</li>
    <li>å³éµé»æ“Šå·¥ä½œè¡¨æ¨™ç±¤</li>
    <li>é¸æ“‡ã€Œé‡æ–°å‘½åã€</li>
    <li>æ”¹æˆä¸Šé¢è¡¨æ ¼ä¸­çš„ä¸­æ–‡åç¨±ï¼ˆå®Œå…¨ç›¸åŒï¼‰</li>
    <li>é‡è¤‡ä»¥ä¸Šæ­¥é©Ÿä¿®æ”¹æ‰€æœ‰å·¥ä½œè¡¨</li>
  </ol>
  
  <div class="success">
    <strong>âœ… å„ªé»ï¼š</strong>
    <ul>
      <li>ä¸éœ€è¦ä¿®æ”¹ä»£ç¢¼</li>
      <li>ç«‹å³ç”Ÿæ•ˆ</li>
      <li>æœ€ç°¡å–®</li>
    </ul>
  </div>
  
  <hr>
  
  <h3>æ–¹æ¡ˆ Bï¼šä¿®æ”¹ Apps Script ä¸­çš„å·¥ä½œè¡¨åç¨±</h3>
  
  <p><strong>å¦‚æœæ‚¨æƒ³ä¿ç•™è‹±æ–‡åç¨±ï¼š</strong></p>
  
  <p>ä¿®æ”¹ <code>google-apps-script.js</code> ç¬¬ 18-28 è¡Œï¼š</p>
  
  <div class="code">
// å¦‚æœæ‚¨çš„å·¥ä½œè¡¨æ˜¯è‹±æ–‡åç¨±
const MEMBERS_SHEET = 'Members';           // æ”¹æˆå¯¦éš›åç¨±
const TRANSACTIONS_SHEET = 'Transactions'; // æ”¹æˆå¯¦éš›åç¨±
const REFERRALS_SHEET = 'Referrals';       // æ”¹æˆå¯¦éš›åç¨±
const PURCHASES_SHEET = 'Purchases';       // æ”¹æˆå¯¦éš›åç¨±
const WITHDRAWALS_SHEET = 'Withdrawals';   // æ”¹æˆå¯¦éš›åç¨±
const PRODUCTS_SHEET = 'Products';         // æ”¹æˆå¯¦éš›åç¨±
const MALL_ORDERS_SHEET = 'MallOrders';    // æ”¹æˆå¯¦éš›åç¨±
const MEMBER_LEVELS_SHEET = 'MemberLevels'; // æ”¹æˆå¯¦éš›åç¨±
const ACTIVITIES_SHEET = 'Activities';     // æ”¹æˆå¯¦éš›åç¨±
const SETTINGS_SHEET = 'Settings';         // æ”¹æˆå¯¦éš›åç¨±
const DAILY_STATS_SHEET = 'DailyStats';    // æ”¹æˆå¯¦éš›åç¨±
  </div>
  
  <p>ç„¶å¾Œé‡æ–°éƒ¨ç½² Apps Scriptï¼ˆé¸æ“‡ã€Œæ–°ç‰ˆæœ¬ã€ï¼‰</p>
  
  <div class="warning">
    <strong>âš ï¸ ç¼ºé»ï¼š</strong>
    <ul>
      <li>éœ€è¦ä¿®æ”¹ä»£ç¢¼</li>
      <li>éœ€è¦é‡æ–°éƒ¨ç½²</li>
      <li>éœ€è¦ç­‰å¾…ç”Ÿæ•ˆ</li>
    </ul>
  </div>
</div>

<div class="card">
  <h2>ğŸ§ª æ¸¬è©¦ API æ˜¯å¦èƒ½æ‰¾åˆ°å·¥ä½œè¡¨</h2>
  
  <button onclick="testSheetAccess()">ğŸš€ æ¸¬è©¦å·¥ä½œè¡¨è¨ªå•</button>
  
  <div id="testResult"></div>
</div>

<div class="card">
  <h2>ğŸ“ éœ€è¦å”åŠ©ï¼Ÿ</h2>
  
  <p><strong>è«‹æä¾›ä»¥ä¸‹è³‡è¨Šï¼š</strong></p>
  
  <ol>
    <li>
      <strong>æ‚¨çš„ Google Sheets å·¥ä½œè¡¨åç¨±</strong>
      <br>æ‰“é–‹ Sheetsï¼Œåº•éƒ¨æ¨™ç±¤é¡¯ç¤ºä»€éº¼åç¨±ï¼Ÿ
      <br>ä¾‹å¦‚ï¼šMembersã€æœƒå“¡è³‡æ–™ã€ä¼šå‘˜èµ„æ–™ï¼Ÿ
    </li>
    
    <li>
      <strong>ç¬¬ä¸€å€‹å·¥ä½œè¡¨çš„ç¬¬ä¸€åˆ—æ¨™é¡Œ</strong>
      <br>ç¬¬ä¸€æ¬„æ˜¯ä»€éº¼ï¼Ÿ
      <br>ä¾‹å¦‚ï¼šlineUserIdã€LINEç”¨æˆ¶IDã€LINEç”¨æˆ·IDï¼Ÿ
    </li>
    
    <li>
      <strong>æœ‰æ²’æœ‰æœƒå“¡è³‡æ–™ï¼Ÿ</strong>
      <br>ã€Œæœƒå“¡è³‡æ–™ã€æˆ–ã€ŒMembersã€å·¥ä½œè¡¨ä¸­æœ‰è³‡æ–™å—ï¼Ÿ
    </li>
  </ol>
  
  <div class="info">
    <strong>ğŸ’¡ å¿«é€Ÿåˆ¤æ–·ï¼š</strong>
    <br>å¦‚æœå·¥ä½œè¡¨åç¨±æ˜¯ <strong>è‹±æ–‡</strong>ï¼ˆMembers, Transactions...ï¼‰ï¼Œå°±æ˜¯åç¨±ä¸åŒ¹é…å•é¡Œï¼
    <br>å¦‚æœå·¥ä½œè¡¨åç¨±æ˜¯ <strong>ä¸­æ–‡</strong>ï¼ˆæœƒå“¡è³‡æ–™ã€äº¤æ˜“è¨˜éŒ„...ï¼‰ï¼Œæ‡‰è©²æ²’å•é¡Œï¼Œå¯èƒ½æ˜¯å…¶ä»–åŸå› ã€‚
  </div>
</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbxh10yJHbTDcwBDTX_V30jRR4CqshDc3pePR0t_rPqCxZg40h636WKIo3-Y--L0cDnP/exec';

async function testSheetAccess() {
  const resultDiv = document.getElementById('testResult');
  resultDiv.innerHTML = '<div class="result info">â³ æ¸¬è©¦ä¸­...</div>';
  
  try {
    // æ¸¬è©¦è¨»å†Šä¸€å€‹ç”¨æˆ¶ï¼ˆæœƒå˜—è©¦è¨ªå•å·¥ä½œè¡¨ï¼‰
    const testUserId = 'TEST-SHEET-' + Date.now();
    const testPhone = '0912-' + Math.floor(Math.random() * 1000).toString().padStart(3, '0') + '-' + Math.floor(Math.random() * 1000).toString().padStart(3, '0');
    
    const url = `${API_URL}?action=register&lineUserId=${testUserId}&name=å·¥ä½œè¡¨æ¸¬è©¦&phone=${testPhone}&email=&birthday=&lineName=æ¸¬è©¦&linePicture=&referralCode=`;
    
    console.log('æ¸¬è©¦ URL:', url);
    
    const response = await fetch(url);
    const data = await response.json();
    
    console.log('æ¸¬è©¦çµæœ:', data);
    
    if (data.success) {
      resultDiv.innerHTML = `
        <div class="result success">
          âœ… å·¥ä½œè¡¨è¨ªå•æ­£å¸¸ï¼
          
          æ¸¬è©¦è¨»å†ŠæˆåŠŸï¼š
          - é»æ•¸ï¼š${data.points}
          - æœƒå“¡ç­‰ç´šï¼š${data.memberLevel}
          - æ¨è–¦ç¢¼ï¼š${data.referralCode}
          
          ğŸ‰ çµè«–ï¼š
          å·¥ä½œè¡¨åç¨±è¨­å®šæ­£ç¢ºï¼
          ã€Œæœƒå“¡è³‡æ–™ã€å·¥ä½œè¡¨å¯ä»¥æ­£å¸¸è®€å¯«ã€‚
          
          è«‹å‰å¾€ Google Sheets ç¢ºèªæ˜¯å¦æœ‰æ–°è¨˜éŒ„ï¼š
          LINEç”¨æˆ¶ID: ${testUserId}
        </div>
      `;
    } else {
      resultDiv.innerHTML = `
        <div class="result error">
          âŒ å·¥ä½œè¡¨è¨ªå•å¤±æ•—ï¼
          
          éŒ¯èª¤è¨Šæ¯ï¼š${data.message}
          å®Œæ•´å›æ‡‰ï¼š
          ${JSON.stringify(data, null, 2)}
          
          ğŸ¯ é€™å¾ˆå¯èƒ½æ˜¯å·¥ä½œè¡¨åç¨±ä¸ä¸€è‡´é€ æˆçš„ï¼
          
          è«‹æª¢æŸ¥ï¼š
          1. Google Sheets ä¸­çš„å·¥ä½œè¡¨æ˜¯å¦å«ã€Œæœƒå“¡è³‡æ–™ã€
          2. å¦‚æœæ˜¯è‹±æ–‡åç¨±ï¼ˆMembersï¼‰ï¼Œè«‹æ”¹æˆä¸­æ–‡
          3. æˆ–ä¿®æ”¹ Apps Script æ”¹ç”¨è‹±æ–‡åç¨±
        </div>
      `;
    }
  } catch (error) {
    resultDiv.innerHTML = `
      <div class="result error">
        âŒ æ¸¬è©¦å¤±æ•—
        
        éŒ¯èª¤ï¼š${error.message}
        
        å¯èƒ½åŸå› ï¼š
        1. ç¶²è·¯é€£æ¥å•é¡Œ
        2. API CORS å•é¡Œ
        3. API ä¼ºæœå™¨éŒ¯èª¤
      </div>
    `;
  }
}
</script>

</body>
</html>

