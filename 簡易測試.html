<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç°¡æ˜“ API æ¸¬è©¦</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 900px;
    margin: 30px auto;
    padding: 20px;
    background: #f5f5f5;
  }
  
  .test-card {
    background: white;
    border-radius: 10px;
    padding: 30px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    margin-bottom: 20px;
  }
  
  h2 {
    color: #667eea;
    margin-top: 0;
  }
  
  button {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    margin: 5px;
  }
  
  button:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
  }
  
  .result {
    background: #f8f9fa;
    border-left: 4px solid #667eea;
    padding: 15px;
    margin: 10px 0;
    border-radius: 5px;
    font-family: monospace;
    white-space: pre-wrap;
    word-break: break-all;
  }
  
  .success {
    border-left-color: #28a745;
    background: #d4edda;
  }
  
  .error {
    border-left-color: #dc3545;
    background: #f8d7da;
  }
  
  .warning {
    border-left-color: #ffc107;
    background: #fff3cd;
  }
</style>
</head>
<body>

<div class="test-card">
  <h2>ğŸ§ª æ­¥é©Ÿ 1ï¼šæ¸¬è©¦ API åŸºæœ¬é€£æ¥ï¼ˆGETï¼‰</h2>
  <button onclick="testBasicAPI()">ğŸš€ æ¸¬è©¦åŸºæœ¬ API</button>
  <div id="result1"></div>
  
  <div style="margin-top: 15px; padding: 10px; background: #e7f3ff; border-radius: 5px;">
    <strong>ğŸ“ èªªæ˜ï¼š</strong>é€™æœƒæ¸¬è©¦ API æ˜¯å¦å¯ä»¥è¨ªå•ã€‚å³ä½¿è¿”å›ã€ŒæœªçŸ¥çš„æ“ä½œã€ä¹Ÿæ˜¯æ­£å¸¸çš„ï¼Œè¡¨ç¤ºé€£æ¥æˆåŠŸã€‚
  </div>
</div>

<div class="test-card">
  <h2>ğŸ§ª æ­¥é©Ÿ 2ï¼šæ¸¬è©¦ LINE è¨»å†Šï¼ˆGETï¼‰</h2>
  <button onclick="testLINERegister()">ğŸ“± æ¸¬è©¦ LINE è¨»å†Š</button>
  <div id="result2"></div>
  
  <div style="margin-top: 15px; padding: 10px; background: #e7f3ff; border-radius: 5px;">
    <strong>ğŸ“ èªªæ˜ï¼š</strong>é€™æœƒä½¿ç”¨ GET æ–¹æ³•æ¸¬è©¦è¨»å†ŠåŠŸèƒ½ã€‚å¦‚æœæˆåŠŸï¼Œä»£è¡¨ Sheets é€£æ¥æ­£å¸¸ã€‚
  </div>
</div>

<div class="test-card">
  <h2>ğŸ§ª æ­¥é©Ÿ 3ï¼šæ¸¬è©¦å¸³è™Ÿå¯†ç¢¼è¨»å†Šï¼ˆPOSTï¼‰</h2>
  <button onclick="testPasswordRegister()">ğŸ” æ¸¬è©¦å¯†ç¢¼è¨»å†Š</button>
  <div id="result3"></div>
  
  <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 5px;">
    <strong>âš ï¸ èªªæ˜ï¼š</strong>é€™æœƒä½¿ç”¨ POST æ–¹æ³•ã€‚å¦‚æœå¤±æ•—ä¸¦é¡¯ç¤ºã€ŒFailed to fetchã€ï¼Œå°±æ˜¯ CORS å•é¡Œã€‚
  </div>
</div>

<div class="test-card">
  <h2>ğŸ“Š ç•¶å‰é…ç½®</h2>
  <div class="result">
API URL:
https://script.google.com/macros/s/AKfycbxh10yJHbTDcwBDTX_V30jRR4CqshDc3pePR0t_rPqCxZg40h636WKIo3-Y--L0cDnP/exec

Sheet ID:
1EdLfJQzYroQ9WMqVEqcDuMpGwiTPj8gxLaMnGp3umDw

é æœŸå·¥ä½œè¡¨åç¨±:
æœƒå“¡è³‡æ–™, äº¤æ˜“è¨˜éŒ„, æ¨è–¦é—œä¿‚...
  </div>
</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbxh10yJHbTDcwBDTX_V30jRR4CqshDc3pePR0t_rPqCxZg40h636WKIo3-Y--L0cDnP/exec';

async function testBasicAPI() {
  const resultDiv = document.getElementById('result1');
  resultDiv.innerHTML = '<div class="result">â³ æ¸¬è©¦ä¸­...</div>';
  
  try {
    const response = await fetch(API_URL);
    const data = await response.json();
    
    resultDiv.innerHTML = `
      <div class="result success">
        âœ… API é€£æ¥æˆåŠŸï¼
        
HTTP ç‹€æ…‹: ${response.status} ${response.statusText}
å›æ‡‰: ${JSON.stringify(data, null, 2)}

çµè«–: API éƒ¨ç½²æ­£å¸¸ï¼Œå¯ä»¥è¨ªå•ã€‚
${data.message === 'æœªçŸ¥çš„æ“ä½œ' ? '\nâœ… é€™å€‹è¨Šæ¯æ˜¯æ­£å¸¸çš„ï¼è¡¨ç¤º API æ­£åœ¨é‹ä½œã€‚' : ''}
      </div>
    `;
  } catch (error) {
    resultDiv.innerHTML = `
      <div class="result error">
        âŒ API é€£æ¥å¤±æ•—
        
éŒ¯èª¤: ${error.message}

å¯èƒ½åŸå› :
1. API URL ä¸æ­£ç¢º
2. ç¶²è·¯é€£æ¥å•é¡Œ
3. API æ²’æœ‰æ­£ç¢ºéƒ¨ç½²
      </div>
    `;
  }
}

async function testLINERegister() {
  const resultDiv = document.getElementById('result2');
  resultDiv.innerHTML = '<div class="result">â³ æ¸¬è©¦ä¸­...</div>';
  
  const timestamp = Date.now();
  const testData = {
    lineUserId: `TEST-${timestamp}`,
    name: `æ¸¬è©¦ç”¨æˆ¶${timestamp}`,
    phone: `0912-${Math.floor(Math.random() * 1000).toString().padStart(3, '0')}-${Math.floor(Math.random() * 1000).toString().padStart(3, '0')}`,
    email: `test${timestamp}@example.com`,
    lineName: 'æ¸¬è©¦ç”¨æˆ¶',
    linePicture: '',
    referralCode: ''
  };
  
  try {
    const url = `${API_URL}?action=register&` + 
                `lineUserId=${encodeURIComponent(testData.lineUserId)}&` +
                `name=${encodeURIComponent(testData.name)}&` +
                `phone=${encodeURIComponent(testData.phone)}&` +
                `email=${encodeURIComponent(testData.email)}&` +
                `lineName=${encodeURIComponent(testData.lineName)}&` +
                `linePicture=${encodeURIComponent(testData.linePicture)}&` +
                `referralCode=${encodeURIComponent(testData.referralCode)}`;
    
    const response = await fetch(url);
    const data = await response.json();
    
    if (data.success) {
      resultDiv.innerHTML = `
        <div class="result success">
          âœ… LINE è¨»å†ŠæˆåŠŸï¼
          
æ¸¬è©¦è³‡æ–™:
- LINE ID: ${testData.lineUserId}
- å§“å: ${testData.name}
- æ‰‹æ©Ÿ: ${testData.phone}

API å›æ‡‰:
${JSON.stringify(data, null, 2)}

ğŸ‰ çµè«–: 
1. API æ­£å¸¸é‹ä½œ
2. Google Sheets é€£æ¥æ­£å¸¸
3. å¯ä»¥å¯«å…¥è³‡æ–™

è«‹å‰å¾€ Google Sheets ç¢ºèªæ˜¯å¦æœ‰æ–°è¨˜éŒ„ï¼š
https://docs.google.com/spreadsheets/d/1EdLfJQzYroQ9WMqVEqcDuMpGwiTPj8gxLaMnGp3umDw/edit
        </div>
      `;
    } else {
      resultDiv.innerHTML = `
        <div class="result error">
          âš ï¸ è¨»å†Šå¤±æ•—
          
éŒ¯èª¤è¨Šæ¯: ${data.message}

å®Œæ•´å›æ‡‰:
${JSON.stringify(data, null, 2)}

å¯èƒ½åŸå› :
1. æ‰‹æ©Ÿè™Ÿç¢¼å·²å­˜åœ¨
2. Google Sheets æ¬Šé™å•é¡Œ
3. å·¥ä½œè¡¨åç¨±ä¸ç¬¦
        </div>
      `;
    }
  } catch (error) {
    resultDiv.innerHTML = `
      <div class="result error">
        âŒ è«‹æ±‚å¤±æ•—
        
éŒ¯èª¤: ${error.message}

å¯èƒ½åŸå› :
1. CORS å•é¡Œ
2. ç¶²è·¯é€£æ¥å•é¡Œ
3. API éŒ¯èª¤
      </div>
    `;
  }
}

async function testPasswordRegister() {
  const resultDiv = document.getElementById('result3');
  resultDiv.innerHTML = '<div class="result">â³ æ¸¬è©¦ä¸­...</div>';
  
  const timestamp = Date.now();
  const testData = {
    action: 'register-password',
    name: `æ¸¬è©¦ç”¨æˆ¶${timestamp}`,
    phone: `0912-${Math.floor(Math.random() * 1000).toString().padStart(3, '0')}-${Math.floor(Math.random() * 1000).toString().padStart(3, '0')}`,
    email: `test${timestamp}@example.com`,
    birthday: '1990-01-01',
    username: `test${timestamp}`,
    password: 'Test1234',
    referralCode: ''
  };
  
  try {
    const response = await fetch(API_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(testData)
    });
    
    const data = await response.json();
    
    if (data.success) {
      resultDiv.innerHTML = `
        <div class="result success">
          âœ… å¯†ç¢¼è¨»å†ŠæˆåŠŸï¼
          
æ¸¬è©¦è³‡æ–™:
- å¸³è™Ÿ: ${testData.username}
- å§“å: ${testData.name}
- æ‰‹æ©Ÿ: ${testData.phone}

API å›æ‡‰:
${JSON.stringify(data, null, 2)}

ğŸ‰ çµè«–: 
1. POST è«‹æ±‚æ­£å¸¸
2. CORS è¨­å®šæ­£ç¢º
3. å¸³è™Ÿå¯†ç¢¼è¨»å†ŠåŠŸèƒ½æ­£å¸¸
4. Google Sheets å¯«å…¥æ­£å¸¸
        </div>
      `;
    } else {
      resultDiv.innerHTML = `
        <div class="result warning">
          âš ï¸ è¨»å†Šå¤±æ•—
          
éŒ¯èª¤è¨Šæ¯: ${data.message}

å®Œæ•´å›æ‡‰:
${JSON.stringify(data, null, 2)}

å¯èƒ½åŸå› :
1. æ‰‹æ©Ÿè™Ÿç¢¼å·²å­˜åœ¨ï¼ˆ${testData.phone}ï¼‰
2. å¸³è™Ÿå·²å­˜åœ¨ï¼ˆ${testData.username}ï¼‰
3. é©—è­‰éŒ¯èª¤
        </div>
      `;
    }
  } catch (error) {
    resultDiv.innerHTML = `
      <div class="result error">
        âŒ POST è«‹æ±‚å¤±æ•—ï¼
        
éŒ¯èª¤: ${error.message}

ğŸ¯ é€™å°±æ˜¯å•é¡Œæ‰€åœ¨ï¼

å¦‚æœéŒ¯èª¤æ˜¯ "Failed to fetch"ï¼Œè¡¨ç¤º:
1. âŒ CORS å•é¡Œ - API éƒ¨ç½²è¨­å®šéŒ¯èª¤
2. âŒ POST è«‹æ±‚è¢«é˜»æ“‹

è§£æ±ºæ–¹æ¡ˆ:
1. å‰å¾€ Google Apps Script
2. éƒ¨ç½² â†’ ç®¡ç†éƒ¨ç½²
3. ç·¨è¼¯éƒ¨ç½²
4. ç¢ºèªã€Œå…·æœ‰å­˜å–æ¬Šçš„ä½¿ç”¨è€…ã€é¸æ“‡ã€Œæ‰€æœ‰äººã€
5. ç¢ºèªã€Œç‰ˆæœ¬ã€é¸æ“‡ã€Œæ–°ç‰ˆæœ¬ã€
6. é‡æ–°éƒ¨ç½²
7. ç­‰å¾… 2 åˆ†é˜
8. å†æ¬¡æ¸¬è©¦
      </div>
    `;
  }
}
</script>

</body>
</html>

