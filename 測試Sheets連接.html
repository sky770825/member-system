<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ¸¬è©¦ Google Sheets é€£æ¥</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 800px;
    margin: 50px auto;
    padding: 20px;
    background: #f5f5f5;
  }
  
  .test-card {
    background: white;
    border-radius: 10px;
    padding: 30px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  }
  
  h1 {
    color: #333;
    margin-bottom: 30px;
  }
  
  .test-item {
    margin: 20px 0;
    padding: 15px;
    border-left: 4px solid #667eea;
    background: #f8f9fa;
    border-radius: 5px;
  }
  
  .test-name {
    font-weight: bold;
    color: #667eea;
    margin-bottom: 10px;
  }
  
  .test-result {
    font-family: monospace;
    background: #fff;
    padding: 10px;
    border-radius: 5px;
    margin-top: 10px;
    white-space: pre-wrap;
    word-break: break-all;
  }
  
  .success {
    color: #28a745;
    border-left-color: #28a745;
  }
  
  .error {
    color: #dc3545;
    border-left-color: #dc3545;
  }
  
  .info {
    color: #17a2b8;
    border-left-color: #17a2b8;
  }
  
  button {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    padding: 15px 30px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    margin: 10px 5px;
  }
  
  button:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
  }
  
  button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
  
  .loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(255,255,255,.3);
    border-radius: 50%;
    border-top-color: #fff;
    animation: spin 1s ease-in-out infinite;
  }
  
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
</style>
</head>
<body>
<div class="test-card">
  <h1>ğŸ” Google Sheets é€£æ¥æ¸¬è©¦</h1>
  
  <div style="margin-bottom: 30px;">
    <button onclick="testAllConnections()">ğŸš€ é–‹å§‹å®Œæ•´æ¸¬è©¦</button>
    <button onclick="testSheetAccess()">ğŸ“‹ æ¸¬è©¦å·¥ä½œè¡¨è¨ªå•</button>
    <button onclick="testRegisterAPI()">âœï¸ æ¸¬è©¦è¨»å†Š API</button>
    <button onclick="clearResults()">ğŸ—‘ï¸ æ¸…é™¤çµæœ</button>
  </div>
  
  <div id="results"></div>
</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbxh10yJHbTDcwBDTX_V30jRR4CqshDc3pePR0t_rPqCxZg40h636WKIo3-Y--L0cDnP/exec';

function addResult(name, result, type = 'info') {
  const resultsDiv = document.getElementById('results');
  const testItem = document.createElement('div');
  testItem.className = `test-item ${type}`;
  testItem.innerHTML = `
    <div class="test-name">${name}</div>
    <div class="test-result">${result}</div>
  `;
  resultsDiv.appendChild(testItem);
}

function clearResults() {
  document.getElementById('results').innerHTML = '';
}

async function testAllConnections() {
  clearResults();
  addResult('ğŸš€ é–‹å§‹æ¸¬è©¦', 'æ­£åœ¨é€²è¡Œå®Œæ•´é€£æ¥æ¸¬è©¦...', 'info');
  
  await testSheetAccess();
  await new Promise(resolve => setTimeout(resolve, 1000));
  await testRegisterAPI();
  
  addResult('âœ… æ¸¬è©¦å®Œæˆ', 'æ‰€æœ‰æ¸¬è©¦å·²å®Œæˆï¼Œè«‹æŸ¥çœ‹ä¸Šæ–¹çµæœ', 'success');
}

async function testSheetAccess() {
  addResult('ğŸ“‹ æ¸¬è©¦å·¥ä½œè¡¨è¨ªå•', 'æ­£åœ¨æ¸¬è©¦...', 'info');
  
  try {
    // ä½¿ç”¨ç°¡å–®çš„æ¸¬è©¦ï¼šç›´æ¥è¨ªå• APIï¼ˆä¸å¸¶åƒæ•¸æœƒè¿”å›"æœªçŸ¥çš„æ“ä½œ"ï¼Œä½†è¡¨ç¤ºé€£æ¥æ­£å¸¸ï¼‰
    const response = await fetch(`${API_URL}`);
    const data = await response.json();
    
    if (data.success) {
      addResult(
        'âœ… å·¥ä½œè¡¨é€£æ¥æˆåŠŸ',
        `Sheet ID: ${data.sheetId || 'æœªè¿”å›'}\n` +
        `API ç‰ˆæœ¬: ${data.version || 'æœªçŸ¥'}\n` +
        `å‡½æ•¸æª¢æŸ¥: ${JSON.stringify(data.functions, null, 2)}`,
        'success'
      );
    } else {
      addResult(
        'âš ï¸ å·¥ä½œè¡¨é€£æ¥ç•°å¸¸',
        `éŒ¯èª¤è¨Šæ¯: ${data.message}\n` +
        `å®Œæ•´å›æ‡‰: ${JSON.stringify(data, null, 2)}`,
        'error'
      );
    }
  } catch (error) {
    addResult(
      'âŒ å·¥ä½œè¡¨é€£æ¥å¤±æ•—',
      `éŒ¯èª¤: ${error.message}\n` +
      `é€™å¯èƒ½è¡¨ç¤º:\n` +
      `1. API éƒ¨ç½²æœ‰å•é¡Œ\n` +
      `2. Google Sheets æ¬Šé™ä¸è¶³\n` +
      `3. SHEET_ID è¨­å®šéŒ¯èª¤`,
      'error'
    );
  }
}

async function testRegisterAPI() {
  addResult('âœï¸ æ¸¬è©¦è¨»å†Š API', 'æ­£åœ¨æ¸¬è©¦è¨»å†ŠåŠŸèƒ½...', 'info');
  
  const testData = {
    name: 'æ¸¬è©¦ç”¨æˆ¶' + Math.floor(Math.random() * 10000),
    phone: '0912-' + Math.floor(Math.random() * 1000).toString().padStart(3, '0') + '-' + Math.floor(Math.random() * 1000).toString().padStart(3, '0'),
    email: 'test' + Date.now() + '@example.com',
    username: 'test' + Date.now(),
    password: 'Test1234',
    referralCode: ''
  };
  
  addResult(
    'â„¹ï¸ æ¸¬è©¦è³‡æ–™',
    `å§“å: ${testData.name}\n` +
    `æ‰‹æ©Ÿ: ${testData.phone}\n` +
    `Email: ${testData.email}\n` +
    `å¸³è™Ÿ: ${testData.username}`,
    'info'
  );
  
  try {
    const response = await fetch(API_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        action: 'register-password',
        ...testData
      })
    });
    
    const data = await response.json();
    
    if (data.success) {
      addResult(
        'âœ… è¨»å†Š API æ­£å¸¸',
        `è¨»å†ŠæˆåŠŸï¼\n` +
        `é»æ•¸: ${data.points}\n` +
        `æœƒå“¡ç­‰ç´š: ${data.memberLevel}\n` +
        `æ¨è–¦ç¢¼: ${data.referralCode}\n` +
        `å®Œæ•´å›æ‡‰: ${JSON.stringify(data, null, 2)}`,
        'success'
      );
      
      // æ¸¬è©¦æ˜¯å¦çœŸçš„å¯«å…¥ Sheets
      addResult(
        'ğŸ” é©—è­‰å¯«å…¥',
        'è«‹å‰å¾€ Google Sheets ç¢ºèªæ˜¯å¦æœ‰æ–°çš„æœƒå“¡è¨˜éŒ„ï¼š\n' +
        `LINEç”¨æˆ¶ID: WEB-${testData.phone}\n` +
        `å§“å: ${testData.name}\n` +
        `æ‰‹æ©Ÿ: ${testData.phone}`,
        'info'
      );
    } else {
      addResult(
        'âš ï¸ è¨»å†Š API è¿”å›éŒ¯èª¤',
        `éŒ¯èª¤è¨Šæ¯: ${data.message}\n` +
        `å®Œæ•´å›æ‡‰: ${JSON.stringify(data, null, 2)}`,
        'error'
      );
    }
  } catch (error) {
    addResult(
      'âŒ è¨»å†Š API è«‹æ±‚å¤±æ•—',
      `éŒ¯èª¤: ${error.message}\n` +
      `é€™å¯èƒ½è¡¨ç¤º:\n` +
      `1. CORS å•é¡Œï¼ˆæª¢æŸ¥ API éƒ¨ç½²è¨­å®šï¼‰\n` +
      `2. API URL ä¸æ­£ç¢º\n` +
      `3. ç¶²è·¯é€£æ¥å•é¡Œ`,
      'error'
    );
  }
}

// è‡ªå‹•é¡¯ç¤ºç•¶å‰ API URL
window.onload = function() {
  addResult(
    'â„¹ï¸ ç•¶å‰é…ç½®',
    `API URL: ${API_URL}\n` +
    `Sheet ID: 1EdLfJQzYroQ9WMqVEqcDuMpGwiTPj8gxLaMnGp3umDw\n` +
    `å·¥ä½œè¡¨åç¨±: æœƒå“¡è³‡æ–™, äº¤æ˜“è¨˜éŒ„, æ¨è–¦é—œä¿‚...`,
    'info'
  );
};
</script>
</body>
</html>

