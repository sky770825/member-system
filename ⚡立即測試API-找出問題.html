<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>âš¡ ç«‹å³æ¸¬è©¦ API - æ‰¾å‡ºå•é¡Œ</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Microsoft JhengHei', sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  padding: 20px;
}
.container {
  max-width: 800px;
  margin: 0 auto;
  background: white;
  border-radius: 20px;
  padding: 30px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.2);
}
h1 {
  color: #667eea;
  margin-bottom: 20px;
  font-size: 28px;
}
.btn {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  border: none;
  padding: 16px 32px;
  border-radius: 12px;
  font-size: 18px;
  font-weight: 700;
  cursor: pointer;
  margin: 10px 10px 10px 0;
  transition: all 0.3s;
  width: 100%;
  max-width: 300px;
}
.btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}
.result {
  background: #f8f9fa;
  border: 3px solid #e0e0e0;
  border-radius: 12px;
  padding: 20px;
  margin-top: 20px;
  font-family: 'Consolas', monospace;
  font-size: 14px;
  white-space: pre-wrap;
  word-wrap: break-word;
  max-height: 400px;
  overflow-y: auto;
  line-height: 1.6;
}
.result.success { border-color: #4CAF50; background: #E8F5E9; }
.result.error { border-color: #f44336; background: #FFEBEE; }
.result.warning { border-color: #FF9800; background: #FFF3E0; }
.step {
  background: #E3F2FD;
  border-left: 4px solid #2196F3;
  padding: 16px;
  margin: 20px 0;
  border-radius: 8px;
}
.step h3 { color: #1976D2; margin-bottom: 12px; }
.important {
  background: #FFF9C4;
  border: 3px solid #FBC02D;
  border-radius: 8px;
  padding: 20px;
  margin: 20px 0;
  font-size: 16px;
}
.loading {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid #f3f3f3;
  border-top: 3px solid #667eea;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-right: 10px;
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
textarea {
  width: 100%;
  padding: 12px;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  font-family: monospace;
  font-size: 12px;
  resize: vertical;
  margin-top: 10px;
}
</style>
</head>
<body>

<div class="container">
  <h1>âš¡ å•†åŸè¼‰å…¥å•é¡Œ - ç«‹å³è¨ºæ–·</h1>
  
  <div class="important">
    <strong>ğŸ¯ æ‚¨çš„å•é¡Œï¼šæ‰‹æ©Ÿè¼‰å…¥å•†å“ä¸€ç›´è½‰åœˆ</strong><br><br>
    <strong>ğŸ“‹ å¯èƒ½åŸå› ï¼š</strong><br>
    1ï¸âƒ£ Google Sheetsã€Œå•†åŸå•†å“ã€å·¥ä½œè¡¨æ²’æœ‰è³‡æ–™<br>
    2ï¸âƒ£ API å›æ‡‰éŒ¯èª¤<br>
    3ï¸âƒ£ è³‡æ–™æ ¼å¼ä¸å°<br><br>
    <strong>âš¡ ç«‹å³æ¸¬è©¦æ‰¾å‡ºåŸå› ï¼</strong>
  </div>
  
  <button class="btn" onclick="testAPI()">ğŸ§ª æ­¥é©Ÿ1ï¼šæ¸¬è©¦ API</button>
  <button class="btn" onclick="showSheetGuide()">ğŸ“‹ æ­¥é©Ÿ2ï¼šæ–°å¢å•†å“è³‡æ–™</button>
  
  <div id="result"></div>
  
  <div class="step" style="margin-top: 30px;">
    <h3>ğŸ“ å¦‚æœ API æ²’æœ‰å•†å“è³‡æ–™</h3>
    <p><strong>è¤‡è£½ä¸‹é¢çš„è³‡æ–™åˆ° Google Sheetsï¼š</strong></p>
    
    <p style="margin-top: 15px;"><strong>ç¬¬1è¡Œï¼ˆæ¬„ä½æ¨™é¡Œï¼‰ï¼š</strong></p>
    <textarea readonly onclick="this.select()" rows="2">productId	productName	description	imageUrl	points	originalPrice	stock	category	sellerId	sellerName	sellerPhone	sellerReferralCode	isActive	soldCount	tags	createdAt	updatedAt</textarea>
    <button class="btn" onclick="copyText(this.previousElementSibling.value, 'æ¬„ä½æ¨™é¡Œ')" style="margin-top: 10px; max-width: 200px; padding: 10px;">ğŸ“‹ è¤‡è£½æ¨™é¡Œ</button>
    
    <p style="margin-top: 15px;"><strong>ç¬¬2è¡Œï¼ˆæ‹æ–°èå•†å“ï¼‰ï¼š</strong></p>
    <textarea readonly onclick="this.select()" rows="2">X7Z5P3	æ‹æ–°è	ç²å¾—æ‹æ–°èè™›æ“¬å•†å“åºè™Ÿ	https://i.postimg.cc/3R5j7t6k/Pi-News-GIF2.gif	3600	3600	-1	virtual			USER001	TRUE	0	è™›æ“¬å•†å“,åºè™Ÿ	2025-10-18	2025-10-18</textarea>
    <button class="btn" onclick="copyText(this.previousElementSibling.value, 'å•†å“è³‡æ–™')" style="margin-top: 10px; max-width: 200px; padding: 10px;">ğŸ“‹ è¤‡è£½å•†å“</button>
  </div>
</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbzMUwqroi_W_5m7rcjVs-U-o6tEo9W0327BeMmU38Rxinmycd5d1HyyF3BnugGvNF6r/exec';

async function testAPI() {
  const resultDiv = document.getElementById('result');
  resultDiv.innerHTML = '<div class="result"><div class="loading"></div>ğŸ§ª æ¸¬è©¦ä¸­ï¼Œè«‹ç¨å€™...</div>';
  
  try {
    const url = `${API_URL}?action=mall-products`;
    console.log('æ¸¬è©¦ URL:', url);
    
    const startTime = Date.now();
    const res = await fetch(url);
    const loadTime = Date.now() - startTime;
    
    const data = await res.json();
    
    let report = 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
    report += 'ğŸ§ª API æ¸¬è©¦çµæœ\n';
    report += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
    
    report += `â±ï¸ å›æ‡‰æ™‚é–“: ${loadTime}ms\n`;
    report += `ğŸ“¡ ç‹€æ…‹ç¢¼: ${res.status} ${res.statusText}\n\n`;
    
    report += 'ğŸ“‹ API å›æ‡‰ï¼š\n';
    report += '-----------------------------------\n';
    report += JSON.stringify(data, null, 2);
    report += '\n\n';
    
    // åˆ†æçµæœ
    report += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
    report += 'ğŸ“Š è¨ºæ–·çµæœ\n';
    report += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
    
    if (data.success) {
      const products = data.products || [];
      
      if (products.length > 0) {
        report += `âœ… æˆåŠŸï¼æ‰¾åˆ° ${products.length} å€‹å•†å“\n\n`;
        
        products.forEach((p, i) => {
          report += `${i + 1}. ${p.productName || 'æœªå‘½å'}\n`;
          report += `   ID: ${p.productId}\n`;
          report += `   é»æ•¸: ${p.points}\n`;
          report += `   ç‹€æ…‹: ${p.isActive ? 'âœ… ä¸Šæ¶' : 'âŒ ä¸‹æ¶'}\n`;
          report += `   åº«å­˜: ${p.stock === -1 ? 'ä¸é™' : p.stock}\n\n`;
        });
        
        report += 'âœ… API æ­£å¸¸ï¼å•†å“è³‡æ–™æ­£ç¢ºï¼\n\n';
        report += 'ğŸ’¡ å¦‚æœæ‰‹æ©Ÿé‚„æ˜¯è½‰åœˆï¼š\n';
        report += '1. æ¸…é™¤ LINE å¿«å–ï¼ˆè¨­å®šâ†’èŠå¤©â†’åˆªé™¤å¿«å–ï¼‰\n';
        report += '2. ç­‰å¾… 2-3 åˆ†é˜è®“ GitHub éƒ¨ç½²å®Œæˆ\n';
        report += '3. é‡æ–°é–‹å•Ÿå•†åŸ\n';
        
        resultDiv.innerHTML = `<div class="result success">${report}</div>`;
      } else {
        report += 'âš ï¸ API æ­£å¸¸ï¼Œä½†æ²’æœ‰å•†å“è³‡æ–™ï¼\n\n';
        report += 'âŒ å•é¡ŒåŸå› ï¼šã€Œå•†åŸå•†å“ã€å·¥ä½œè¡¨æ˜¯ç©ºçš„\n\n';
        report += 'âœ… è§£æ±ºæ–¹æ³•ï¼š\n';
        report += '1. é–‹å•Ÿ Google Sheets\n';
        report += '2. æ‰¾åˆ°ã€Œå•†åŸå•†å“ã€å·¥ä½œè¡¨ï¼ˆåº•éƒ¨æ¨™ç±¤ï¼‰\n';
        report += '3. è¤‡è£½ä¸‹æ–¹çš„ã€Œæ¬„ä½æ¨™é¡Œã€åˆ°ç¬¬1è¡Œï¼ˆA1ï¼‰\n';
        report += '4. è¤‡è£½ä¸‹æ–¹çš„ã€Œå•†å“è³‡æ–™ã€åˆ°ç¬¬2è¡Œï¼ˆA2ï¼‰\n';
        report += '5. é‡æ–°æ¸¬è©¦\n';
        
        resultDiv.innerHTML = `<div class="result warning">${report}</div>`;
      }
    } else {
      report += 'âŒ API å›æ‡‰å¤±æ•—\n\n';
      report += `éŒ¯èª¤è¨Šæ¯: ${data.message || 'æœªçŸ¥éŒ¯èª¤'}\n\n`;
      report += 'å¯èƒ½åŸå› ï¼š\n';
      report += '1. ã€Œå•†åŸå•†å“ã€å·¥ä½œè¡¨ä¸å­˜åœ¨\n';
      report += '2. å·¥ä½œè¡¨åç¨±éŒ¯èª¤ï¼ˆå¿…é ˆæ˜¯ä¸­æ–‡ã€Œå•†åŸå•†å“ã€ï¼‰\n';
      report += '3. Apps Script æ²’æœ‰è™•ç† mall-products\n\n';
      report += 'è§£æ±ºæ–¹æ³•ï¼š\n';
      report += '1. æª¢æŸ¥ Google Sheets æœ‰æ²’æœ‰ã€Œå•†åŸå•†å“ã€å·¥ä½œè¡¨\n';
      report += '2. å¦‚æœæ²’æœ‰ï¼Œæ–°å¢ä¸€å€‹å·¥ä½œè¡¨ä¸¦å‘½åç‚ºã€Œå•†åŸå•†å“ã€\n';
      report += '3. ä½¿ç”¨ä¸‹æ–¹çš„è¤‡è£½åŠŸèƒ½è²¼ä¸Šè³‡æ–™\n';
      
      resultDiv.innerHTML = `<div class="result error">${report}</div>`;
    }
    
  } catch (error) {
    let report = 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
    report += 'âŒ API è«‹æ±‚å¤±æ•—\n';
    report += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
    report += `éŒ¯èª¤: ${error.message}\n\n`;
    report += 'å¯èƒ½åŸå› ï¼š\n';
    report += '1. ç¶²è·¯é€£ç·šå•é¡Œ\n';
    report += '2. API URL ä¸æ­£ç¢º\n';
    report += '3. CORS è·¨åŸŸå•é¡Œ\n';
    report += '4. Apps Script æœªæ­£ç¢ºéƒ¨ç½²\n\n';
    report += `API URL: ${API_URL}\n`;
    
    resultDiv.innerHTML = `<div class="result error">${report}</div>`;
  }
}

function showSheetGuide() {
  const resultDiv = document.getElementById('result');
  
  let guide = 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
  guide += 'ğŸ“‹ æ–°å¢å•†å“è³‡æ–™åˆ° Google Sheets\n';
  guide += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
  
  guide += 'æ­¥é©Ÿ 1ï¼šé–‹å•Ÿ Google Sheets\n';
  guide += '-----------------------------------\n';
  guide += 'https://docs.google.com/spreadsheets/d/\n';
  guide += '1EdLfJQzYroQ9WMqVEqcDuMpGwiTPj8gxLaMnGp3umDw/edit\n\n';
  
  guide += 'æ­¥é©Ÿ 2ï¼šæ‰¾åˆ°ã€Œå•†åŸå•†å“ã€å·¥ä½œè¡¨\n';
  guide += '-----------------------------------\n';
  guide += 'åœ¨ Google Sheets åº•éƒ¨æ‰¾åˆ°ã€Œå•†åŸå•†å“ã€æ¨™ç±¤\n';
  guide += 'ï¼ˆå¦‚æœæ²’æœ‰ï¼Œè«‹æ–°å¢ä¸€å€‹å·¥ä½œè¡¨ä¸¦å‘½åç‚ºã€Œå•†åŸå•†å“ã€ï¼‰\n\n';
  
  guide += 'æ­¥é©Ÿ 3ï¼šè¤‡è£½æ¬„ä½æ¨™é¡Œ\n';
  guide += '-----------------------------------\n';
  guide += '1. é»æ“Šä¸Šæ–¹ã€ŒğŸ“‹ è¤‡è£½æ¨™é¡Œã€æŒ‰éˆ•\n';
  guide += '2. åˆ° Google Sheets é»é¸ A1 æ ¼\n';
  guide += '3. æŒ‰ Ctrl+V è²¼ä¸Š\n\n';
  
  guide += 'æ­¥é©Ÿ 4ï¼šè¤‡è£½å•†å“è³‡æ–™\n';
  guide += '-----------------------------------\n';
  guide += '1. é»æ“Šä¸Šæ–¹ã€ŒğŸ“‹ è¤‡è£½å•†å“ã€æŒ‰éˆ•\n';
  guide += '2. åˆ° Google Sheets é»é¸ A2 æ ¼\n';
  guide += '3. æŒ‰ Ctrl+V è²¼ä¸Š\n\n';
  
  guide += 'æ­¥é©Ÿ 5ï¼šæ¸¬è©¦\n';
  guide += '-----------------------------------\n';
  guide += 'é»æ“Šã€ŒğŸ§ª æ­¥é©Ÿ1ï¼šæ¸¬è©¦ APIã€æŒ‰éˆ•\n';
  guide += 'æ‡‰è©²çœ‹åˆ°ã€Œæ‰¾åˆ° 1 å€‹å•†å“ã€\n\n';
  
  guide += 'å®Œæˆï¼âœ…\n';
  
  resultDiv.innerHTML = `<div class="result">${guide}</div>`;
}

function copyText(text, type) {
  navigator.clipboard.writeText(text).then(() => {
    alert(`âœ… ${type}å·²è¤‡è£½ï¼\n\nè«‹åˆ° Google Sheets è²¼ä¸Š`);
  }).catch(() => {
    alert('âŒ è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–ä¸¦è¤‡è£½');
  });
}

// é é¢è¼‰å…¥æ™‚è‡ªå‹•æ¸¬è©¦
window.addEventListener('load', () => {
  console.log('âš¡ è¨ºæ–·å·¥å…·å·²è¼‰å…¥');
  // è‡ªå‹•æ¸¬è©¦
  setTimeout(() => {
    testAPI();
  }, 500);
});
</script>

</body>
</html>

