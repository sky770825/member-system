# 快速配置指南

## 📝 需要修改的地方總覽

完成部署需要修改以下檔案中的設定：

### ✅ 檢查清單

- [ ] Google Apps Script 中的 SHEET_ID
- [ ] register.html 中的 LIFF ID 和 API URL
- [ ] profile.html 中的 LIFF ID 和 API URL
- [ ] transfer.html 中的 LIFF ID 和 API URL
- [ ] LINE Developers Console 中的 LIFF Endpoint URL

---

## 🔧 詳細修改步驟

### 1. Google Apps Script 設定

**檔案:** `google-apps-script.js`

**第 10 行:**
```javascript
const SHEET_ID = 'YOUR_GOOGLE_SHEET_ID'; // ← 替換這裡
```

**如何取得 Sheet ID:**
1. 開啟您的 Google Sheets
2. 查看瀏覽器網址列
3. 複製 `/d/` 和 `/edit` 之間的文字

**範例:**
```
網址: https://docs.google.com/spreadsheets/d/1EdLfJQzYroQ9WMqVEqcDuMpGwiTPj8gxLaMnGp3umDw/edit
Sheet ID: 1EdLfJQzYroQ9WMqVEqcDuMpGwiTPj8gxLaMnGp3umDw
```

---

### 2. register.html 設定

**需要修改的地方:**

#### (1) LIFF ID - 第 63 行
```javascript
await liff.init({ liffId: "1234567890-AbCdEfGh" }); // ← 替換為您的註冊頁面 LIFF ID
```

#### (2) 檢查會員 API - 第 77 行
```javascript
const checkRes = await fetch(`https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec?action=check&lineUserId=${lineUserId}`);
```

#### (3) 跳轉網址 - 第 83-86 行
```javascript
liff.openWindow({ 
  url: "https://YOUR_USERNAME.github.io/YOUR_REPO/profile.html", 
  external: false 
});
```

#### (4) 註冊 API - 第 113 行
```javascript
const res = await fetch('https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec?action=register', {
```

#### (5) 註冊成功跳轉 - 第 126-129 行
```javascript
liff.openWindow({ 
  url: "https://YOUR_USERNAME.github.io/YOUR_REPO/profile.html", 
  external: false 
});
```

**完整替換範例:**
```javascript
// 假設您的設定如下：
// LIFF ID: 2000000001-AbCd1234
// Apps Script: https://script.google.com/macros/s/AKfycbz.../exec
// GitHub Pages: https://myname.github.io/member-system/

// 第 63 行
await liff.init({ liffId: "2000000001-AbCd1234" });

// 第 77 行
const checkRes = await fetch(`https://script.google.com/macros/s/AKfycbz.../exec?action=check&lineUserId=${lineUserId}`);

// 第 83-86 行
liff.openWindow({ 
  url: "https://myname.github.io/member-system/profile.html", 
  external: false 
});

// 第 113 行
const res = await fetch('https://script.google.com/macros/s/AKfycbz.../exec?action=register', {
```

---

### 3. profile.html 設定

**需要修改的地方:**

#### (1) LIFF ID - 第 21 行
```javascript
await liff.init({ liffId: "2000000002-EfGh5678" }); // ← 會員中心的 LIFF ID
```

#### (2) 取得會員資料 API - 第 33 行
```javascript
const res = await fetch("https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec?action=profile&lineUserId=" + lineUserId);
```

#### (3) 轉點按鈕跳轉 - 第 92-95 行
```javascript
function goTransfer() {
  liff.openWindow({ 
    url: "https://YOUR_USERNAME.github.io/YOUR_REPO/transfer.html", 
    external: false 
  });
}
```

#### (4) 點數記錄按鈕 - 第 98-102 行
```javascript
function goHistory() {
  liff.openWindow({ 
    url: "https://YOUR_USERNAME.github.io/YOUR_REPO/history.html", 
    external: false 
  });
}
```

#### (5) 編輯資料按鈕 - 第 105-109 行
```javascript
function editProfile() {
  liff.openWindow({ 
    url: "https://YOUR_USERNAME.github.io/YOUR_REPO/edit.html", 
    external: false 
  });
}
```

---

### 4. transfer.html 設定

**需要修改的地方:**

#### (1) LIFF ID - 第 85 行
```javascript
await liff.init({ liffId: "2000000003-IjKl9012" }); // ← 轉點頁面的 LIFF ID
```

#### (2) 取得會員點數 API - 第 96 行
```javascript
const res = await fetch(`https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec?action=profile&lineUserId=${lineUserId}`);
```

#### (3) 檢查收款人 API - 第 120 行
```javascript
const res = await fetch(`https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec?action=check-user&phone=${phone}`);
```

#### (4) 轉點 API - 第 213 行
```javascript
const res = await fetch('https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec?action=transfer', {
```

---

### 5. LINE Developers Console 設定

前往 [LINE Developers Console](https://developers.line.biz/console/)

#### 更新 LIFF Endpoint URLs

找到您的 3 個 LIFF 應用，分別設定：

1. **會員註冊 LIFF**
   - Endpoint URL: `https://YOUR_USERNAME.github.io/YOUR_REPO/register.html`

2. **會員中心 LIFF**
   - Endpoint URL: `https://YOUR_USERNAME.github.io/YOUR_REPO/profile.html`

3. **點數轉移 LIFF**
   - Endpoint URL: `https://YOUR_USERNAME.github.io/YOUR_REPO/transfer.html`

---

## 🚀 使用搜尋取代功能

為了方便修改，您可以使用編輯器的「搜尋取代」功能：

### 步驟 1: 準備您的資訊

```
您的 Google Sheet ID: 1EdLfJQzYroQ9WMqVEqcDuMpGwiTPj8gxLaMnGp3umDw
您的 Apps Script URL: https://script.google.com/macros/s/AKfycbz.../exec
您的 GitHub Pages: https://myname.github.io/member-system

LIFF ID (註冊): 2000000001-AbCd1234
LIFF ID (會員中心): 2000000002-EfGh5678
LIFF ID (轉點): 2000000003-IjKl9012
```

### 步驟 2: 批次取代

在 VSCode、Notepad++ 或其他編輯器中：

#### google-apps-script.js
```
搜尋: YOUR_GOOGLE_SHEET_ID
取代為: 1EdLfJQzYroQ9WMqVEqcDuMpGwiTPj8gxLaMnGp3umDw
```

#### register.html
```
搜尋: YOUR_LIFF_ID
取代為: 2000000001-AbCd1234

搜尋: https://YOUR_N8N_URL/webhook
取代為: https://script.google.com/macros/s/AKfycbz.../exec?action

搜尋: https://YOUR_DOMAIN
取代為: https://myname.github.io/member-system
```

#### profile.html
```
搜尋: YOUR_LIFF_ID
取代為: 2000000002-EfGh5678

搜尋: https://YOUR_N8N_URL/webhook
取代為: https://script.google.com/macros/s/AKfycbz.../exec?action

搜尋: https://YOUR_DOMAIN
取代為: https://myname.github.io/member-system
```

#### transfer.html
```
搜尋: YOUR_LIFF_ID
取代為: 2000000003-IjKl9012

搜尋: https://YOUR_N8N_URL/webhook
取代為: https://script.google.com/macros/s/AKfycbz.../exec?action
```

---

## 🧪 測試檢查清單

完成設定後，請依序測試：

### ✅ 1. Google Apps Script 測試

在 Apps Script 編輯器中執行：

```javascript
// 測試：建立範例資料
createSampleData();
Logger.log('測試資料建立完成');

// 測試：取得統計資料
const stats = getStatistics();
Logger.log('統計資料:', stats);
```

### ✅ 2. API 端點測試

使用瀏覽器或 curl 測試：

```bash
# 測試檢查會員
https://script.google.com/macros/s/YOUR_ID/exec?action=check&lineUserId=TEST001

# 測試取得資料
https://script.google.com/macros/s/YOUR_ID/exec?action=profile&lineUserId=U001
```

### ✅ 3. LIFF 頁面測試

1. 在 LINE 聊天室中輸入 LIFF URL：
   ```
   https://liff.line.me/2000000001-AbCd1234
   ```

2. 檢查是否正確開啟註冊頁面

3. 嘗試完整的註冊流程

### ✅ 4. 完整流程測試

- [ ] 註冊新會員
- [ ] 檢查 Google Sheets 是否新增資料
- [ ] 確認贈送 100 點
- [ ] 開啟會員中心查看資料
- [ ] 測試轉點功能
- [ ] 檢查點數是否正確扣除和增加

---

## 🔍 常見錯誤排查

### 錯誤 1: "系統錯誤，請稍後再試"

**可能原因:**
- Apps Script URL 不正確
- CORS 問題
- Apps Script 部署設定錯誤

**解決方法:**
1. 檢查 Apps Script 部署設定
2. 確認「具有應用程式存取權的使用者」為「所有人」
3. 重新部署 Apps Script

### 錯誤 2: "LIFF 初始化錯誤"

**可能原因:**
- LIFF ID 不正確
- Endpoint URL 設定錯誤

**解決方法:**
1. 檢查 LIFF ID 是否正確
2. 確認 Endpoint URL 使用 HTTPS
3. 檢查網域是否已部署

### 錯誤 3: "找不到會員資料"

**可能原因:**
- Google Sheet ID 不正確
- 工作表名稱錯誤
- 沒有正確的存取權限

**解決方法:**
1. 檢查 SHEET_ID 是否正確
2. 確認工作表名稱為 "Members" 和 "Transactions"
3. 檢查 Apps Script 執行紀錄

### 錯誤 4: 跳轉失敗

**可能原因:**
- 網址格式不正確
- 使用了 `http://` 而非 `https://`

**解決方法:**
1. 確認所有網址使用 HTTPS
2. 檢查 `liff.openWindow()` 參數

---

## 📞 取得協助

如果遇到問題：

1. **檢查瀏覽器 Console**
   - 按 F12 開啟開發者工具
   - 查看 Console 中的錯誤訊息

2. **檢查 Apps Script 執行紀錄**
   - 在 Apps Script 編輯器
   - 點選「執行」→「執行紀錄」

3. **檢查 Google Sheets**
   - 確認資料是否正確寫入
   - 檢查欄位格式

---

**配置完成後，您就可以開始使用會員註冊系統了！** 🎉

